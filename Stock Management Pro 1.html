<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Notification Toast -->
    <div id="notification" class="fixed top-4 right-4 z-50 hidden transform transition-all duration-300 ease-in-out">
        <div class="bg-white border-l-4 border-green-500 rounded-xl shadow-2xl p-5 max-w-sm backdrop-blur-sm">
            <div class="flex items-center">
                <div class="flex-shrink-0 bg-green-100 rounded-full p-2">
                    <span id="notification-icon" class="text-xl">‚úÖ</span>
                </div>
                <div class="ml-4 flex-1">
                    <p id="notification-message" class="text-sm font-semibold text-gray-800"></p>
                </div>
                <button onclick="hideNotification()" class="ml-3 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full p-1 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md mx-4 transform transition-all duration-300 scale-95 opacity-0" id="delete-modal-content">
            <!-- Header -->
            <div class="text-center mb-6">
                <div class="mx-auto flex items-center justify-center w-16 h-16 rounded-full bg-red-100 mb-4">
                    <span id="delete-icon" class="text-3xl">üóëÔ∏è</span>
                </div>
                <h3 id="delete-title" class="text-xl font-bold text-gray-900 mb-2">Delete Confirmation</h3>
                <p id="delete-item-name" class="text-sm text-gray-600 font-medium bg-gray-100 px-3 py-1 rounded-full inline-block"></p>
            </div>
            
            <!-- Message -->
            <div class="mb-6">
                <p id="delete-message" class="text-gray-700 text-center mb-4"></p>
                <div id="delete-warning" class="hidden bg-red-50 border-l-4 border-red-400 p-4 rounded-lg">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <span class="text-red-400 text-lg">‚ö†Ô∏è</span>
                        </div>
                        <div class="ml-3">
                            <p id="delete-warning-text" class="text-sm text-red-700"></p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Actions -->
            <div class="flex gap-3 justify-center">
                <button onclick="hideDeleteConfirmation()" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105">
                    <span class="mr-2">‚ùå</span>
                    Cancel
                </button>
                <button id="delete-confirm-btn" onclick="confirmDelete()" class="flex-1 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 shadow-lg">
                    <span class="mr-2">üóëÔ∏è</span>
                    Delete
                </button>
            </div>
        </div>
    </div>

    <!-- Category Management Modal -->
    <div id="category-modal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-lg mx-4 transform transition-all duration-300 scale-95 opacity-0" id="modal-content">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3">
                    <div class="bg-blue-100 p-3 rounded-full">
                        <span class="text-2xl">üìÇ</span>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800">Manage Categories</h3>
                </div>
                <button onclick="hideCategoryModal()" class="text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full p-2 transition-all">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">Add New Category</label>
                <div class="flex gap-3">
                    <input type="text" id="new-category-input" placeholder="Enter category name..." class="flex-1 border border-gray-300 rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                    <button onclick="addCategoryFromModal()" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-6 py-3 rounded-xl text-sm font-semibold transition-all transform hover:scale-105 shadow-lg">
                        ‚ú® Add
                    </button>
                </div>
            </div>
            
            <div class="max-h-80 overflow-y-auto">
                <h4 class="text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2">
                    <span class="bg-gray-100 p-1 rounded">üìã</span>
                    Existing Categories
                </h4>
                <div id="modal-category-list" class="space-y-2">
                    <!-- Categories will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl shadow-lg p-6 mb-8 text-white">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold mb-2">üì¶ Stock Management Pro</h1>
                    <p class="text-blue-100">Advanced inventory management with real-time analytics</p>
                </div>
                <div class="text-right">
                    <div class="text-sm text-blue-100">Current Time</div>
                    <div id="current-time" class="text-lg font-semibold"></div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="bg-white rounded-xl shadow-lg mb-8">
            <div class="flex border-b overflow-x-auto">
                <button onclick="showTab('dashboard')" id="dashboard-tab" class="tab-button px-6 py-4 font-medium text-blue-600 border-b-2 border-blue-600 whitespace-nowrap transition-all">üìä Dashboard</button>
                <button onclick="showTab('items')" id="items-tab" class="tab-button px-6 py-4 font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap transition-all">üì¶ Item Management</button>
                <button onclick="showTab('transactions')" id="transactions-tab" class="tab-button px-6 py-4 font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap transition-all">üí∞ Transactions</button>
                <button onclick="showTab('lowstock')" id="lowstock-tab" class="tab-button px-6 py-4 font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap transition-all">‚ö†Ô∏è Low Stock</button>
                <button onclick="showTab('ledger')" id="ledger-tab" class="tab-button px-6 py-4 font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap transition-all">üìä Stock Ledger</button>
            </div>
            
            <!-- Debug Panel (Hidden) -->
            <div class="p-4 bg-yellow-50 border-t border-yellow-200 hidden">
                <div class="flex items-center gap-4 text-sm">
                    <span class="font-semibold text-yellow-800">üîß Debug Panel:</span>
                    <button onclick="console.log('All tabs:', document.querySelectorAll('.tab-content')); console.log('All buttons:', document.querySelectorAll('.tab-button'));" class="bg-yellow-200 hover:bg-yellow-300 text-yellow-800 px-3 py-1 rounded text-xs">Check Elements</button>
                    <button onclick="showTab('dashboard'); console.log('Dashboard clicked');" class="bg-blue-200 hover:bg-blue-300 text-blue-800 px-3 py-1 rounded text-xs">Test Dashboard</button>
                    <button onclick="showTab('items'); console.log('Items clicked');" class="bg-green-200 hover:bg-green-300 text-green-800 px-3 py-1 rounded text-xs">Test Items</button>
                    <button onclick="alert('Tab system working! Check console for logs.');" class="bg-purple-200 hover:bg-purple-300 text-purple-800 px-3 py-1 rounded text-xs">Test Alert</button>
                </div>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm">Total Items</p>
                            <p class="text-2xl font-bold text-gray-800" id="total-items">0</p>
                        </div>
                        <div class="bg-blue-100 p-3 rounded-full">
                            <span class="text-2xl">üìã</span>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm">Low Stock Items</p>
                            <p class="text-2xl font-bold text-red-600" id="low-stock">0</p>
                        </div>
                        <div class="bg-red-100 p-3 rounded-full">
                            <span class="text-2xl">‚ö†Ô∏è</span>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm">Total Transactions</p>
                            <p class="text-2xl font-bold text-green-600" id="total-transactions">0</p>
                        </div>
                        <div class="bg-green-100 p-3 rounded-full">
                            <span class="text-2xl">üí∞</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Dashboard Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <!-- Low Stock Alert -->
                <div class="bg-gradient-to-br from-red-50 to-rose-100 rounded-xl shadow-lg p-6 border-l-4 border-red-500">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-red-800 flex items-center gap-2">
                            <span class="bg-red-100 p-2 rounded-full">‚ö†Ô∏è</span>
                            Low Stock Alert
                        </h3>
                        <span class="bg-red-500 text-white px-3 py-1 rounded-full text-sm font-medium" id="low-stock-badge">0</span>
                    </div>
                    <div id="low-stock-items" class="space-y-2 max-h-48 overflow-y-auto">
                        <p class="text-red-600 text-sm text-center py-4">‡§∏‡§≠‡•Ä ‡§Ü‡§á‡§ü‡§Æ‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§™‡§∞‡•ç‡§Ø‡§æ‡§™‡•ç‡§§ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§π‡•à ‚úÖ</p>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-gradient-to-br from-blue-50 to-indigo-100 rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-blue-800 flex items-center gap-2">
                            <span class="bg-blue-100 p-2 rounded-full">üìà</span>
                            Recent Activity
                        </h3>
                        <span class="bg-blue-500 text-white px-3 py-1 rounded-full text-sm font-medium" id="recent-count">0</span>
                    </div>
                    <div id="recent-transactions" class="space-y-2 max-h-48 overflow-y-auto">
                        <p class="text-blue-600 text-sm text-center py-4">‡§ï‡•ã‡§à ‡§π‡§æ‡§≤ ‡§ï‡•Ä ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§®‡§π‡•Ä‡§Ç</p>
                    </div>
                </div>
            </div>

            <!-- Quick Stats Grid -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <!-- Total Value Card -->
                <div class="bg-gradient-to-br from-green-50 to-emerald-100 rounded-xl shadow-lg p-4 border-l-4 border-green-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-600 text-xs font-medium uppercase tracking-wide">Total Value</p>
                            <p class="text-xl font-bold text-green-800" id="total-value">‚Çπ0</p>
                        </div>
                        <div class="bg-green-100 p-2 rounded-full">
                            <span class="text-lg">üí∞</span>
                        </div>
                    </div>
                </div>

                <!-- Categories Card -->
                <div class="bg-gradient-to-br from-purple-50 to-violet-100 rounded-xl shadow-lg p-4 border-l-4 border-purple-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-600 text-xs font-medium uppercase tracking-wide">Categories</p>
                            <p class="text-xl font-bold text-purple-800" id="total-categories">0</p>
                        </div>
                        <div class="bg-purple-100 p-2 rounded-full">
                            <span class="text-lg">üìÇ</span>
                        </div>
                    </div>
                </div>

                <!-- In Stock Card -->
                <div class="bg-gradient-to-br from-cyan-50 to-sky-100 rounded-xl shadow-lg p-4 border-l-4 border-cyan-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-cyan-600 text-xs font-medium uppercase tracking-wide">In Stock</p>
                            <p class="text-xl font-bold text-cyan-800" id="in-stock-items">0</p>
                        </div>
                        <div class="bg-cyan-100 p-2 rounded-full">
                            <span class="text-lg">‚úÖ</span>
                        </div>
                    </div>
                </div>

                <!-- Today's Activity Card -->
                <div class="bg-gradient-to-br from-orange-50 to-amber-100 rounded-xl shadow-lg p-4 border-l-4 border-orange-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-orange-600 text-xs font-medium uppercase tracking-wide">Today's Activity</p>
                            <p class="text-xl font-bold text-orange-800" id="today-transactions">0</p>
                        </div>
                        <div class="bg-orange-100 p-2 rounded-full">
                            <span class="text-lg">üìä</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Category Overview -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
                        <span class="bg-gray-100 p-2 rounded-full">üìã</span>
                        Category Overview
                    </h3>
                    <button onclick="showTab('items')" class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all transform hover:scale-105 shadow-md">
                        ‚ûï Add Items
                    </button>
                </div>
                <div id="category-overview" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="text-center py-8 text-gray-500 col-span-full">
                        <span class="text-4xl mb-2 block">üì¶</span>
                        <p>‡§ï‡•ã‡§à ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä</p>
                        <p class="text-sm text-gray-400 mt-1">‡§Ü‡§á‡§ü‡§Æ ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ä‡§™‡§∞ ‡§¨‡§ü‡§® ‡§¶‡§¨‡§æ‡§è‡§Ç</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Items Tab -->
        <div id="items" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Add New Item</h3>
                


                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <input type="text" id="item-name" placeholder="Item Name *" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <div class="relative">
                        <input type="text" id="item-category" placeholder="Type to search or select category *" class="w-full border border-gray-300 rounded-lg px-4 py-2 pr-12 focus:ring-2 focus:ring-blue-500 focus:border-transparent" autocomplete="off" oninput="handleCategoryInput()" onfocus="showCategoryDropdown()" onkeydown="handleCategoryKeydown(event)">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                            <button type="button" onclick="toggleCategoryDropdown()" class="text-gray-400 hover:text-gray-600">
                                <svg id="dropdown-arrow" class="w-5 h-5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                        </div>
                        <div id="category-dropdown" class="absolute z-20 w-full bg-white border border-gray-200 rounded-xl mt-2 shadow-2xl hidden backdrop-blur-sm transform transition-all duration-200 scale-95 opacity-0">
                            <!-- Header with Add Button -->
                            <div class="p-4 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-t-xl">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <span class="text-lg">üìÇ</span>
                                        <h4 class="text-sm font-semibold text-gray-700">Categories</h4>
                                    </div>
                                    <button onclick="showAddCategoryInline()" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-3 py-1.5 rounded-lg text-xs font-semibold transition-all transform hover:scale-105 shadow-md">
                                        ‚ú® Add New
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Add Category Form (Hidden by default) -->
                            <div id="add-category-form" class="p-4 border-b border-gray-100 bg-gradient-to-r from-green-50 to-emerald-50 hidden">
                                <div class="flex gap-2">
                                    <input type="text" id="new-category-name" placeholder="Category name..." class="flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all">
                                    <button onclick="addNewCategory()" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-4 py-2 rounded-lg text-xs font-semibold transition-all transform hover:scale-105">
                                        üíæ Save
                                    </button>
                                    <button onclick="cancelAddCategory()" class="bg-gray-400 hover:bg-gray-500 text-white px-3 py-2 rounded-lg text-xs font-medium transition-all">
                                        ‚ùå Cancel
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Category List -->
                            <div id="category-options" class="max-h-52 overflow-y-auto">
                                <!-- Category options will be populated here -->
                            </div>
                            
                            <!-- Footer -->
                            <div class="p-3 border-t border-gray-100 bg-gradient-to-r from-gray-50 to-slate-50 rounded-b-xl">
                                <div class="flex items-center justify-center gap-4 text-xs text-gray-500">
                                    <span class="flex items-center gap-1">
                                        <span class="bg-blue-100 text-blue-600 px-1.5 py-0.5 rounded font-mono">‚å®Ô∏è</span>
                                        Type to search
                                    </span>
                                    <span class="flex items-center gap-1">
                                        <span class="bg-green-100 text-green-600 px-1.5 py-0.5 rounded font-mono">‚Üë‚Üì</span>
                                        Navigate
                                    </span>
                                    <span class="flex items-center gap-1">
                                        <span class="bg-purple-100 text-purple-600 px-1.5 py-0.5 rounded font-mono">‚èé</span>
                                        Select
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <input type="number" id="item-quantity" placeholder="Opening Qty" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <input type="number" id="item-min-stock" placeholder="Min Stock Level" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <input type="number" id="item-price" placeholder="Unit Price (‚Çπ)" step="0.01" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <button onclick="addItem()" class="mt-4 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-6 py-2 rounded-lg font-medium transition-all transform hover:scale-105 shadow-lg">
                    <span class="mr-2">‚ú®</span>
                    Add Item
                </button>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold text-gray-800">Item Inventory</h3>
                    <div class="flex gap-3">
                        <input type="text" id="search-items" placeholder="üîç Search items..." class="border border-gray-300 rounded-lg px-4 py-2 w-64 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <button onclick="exportData('items')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">üìä Export</button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200 bg-gray-50">
                                <th class="text-left py-3 px-4 font-medium text-gray-700">Item Name</th>
                                <th class="text-left py-3 px-4 font-medium text-gray-700">Category</th>
                                <th class="text-left py-3 px-4 font-medium text-gray-700">Stock</th>
                                <th class="text-left py-3 px-4 font-medium text-gray-700">Price (‚Çπ)</th>
                                <th class="text-left py-3 px-4 font-medium text-gray-700">Value (‚Çπ)</th>
                                <th class="text-left py-3 px-4 font-medium text-gray-700">Status</th>
                                <th class="text-left py-3 px-4 font-medium text-gray-700">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="items-table">
                            <tr>
                                <td colspan="7" class="text-center py-8 text-gray-500">No items added yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Transactions Tab -->
        <div id="transactions" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold text-gray-800" id="transaction-form-title">Record Transaction</h3>
                    <button id="cancel-edit-btn" onclick="cancelTransactionEdit()" class="hidden bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                        ‚ùå Cancel Edit
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="relative">
                        <input type="text" id="transaction-item" placeholder="Type to search items..." class="w-full border border-gray-300 rounded-lg px-4 py-2 pr-12 focus:ring-2 focus:ring-blue-500 focus:border-transparent" autocomplete="off" oninput="handleItemInput()" onfocus="showItemDropdown()" onkeydown="handleItemKeydown(event)">
                        <input type="hidden" id="transaction-item-id" value="">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                            <button type="button" onclick="toggleItemDropdown()" class="text-gray-400 hover:text-gray-600">
                                <svg id="item-dropdown-arrow" class="w-5 h-5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                        </div>
                        <div id="item-dropdown" class="absolute z-20 w-full bg-white border border-gray-200 rounded-xl mt-2 shadow-2xl hidden backdrop-blur-sm transform transition-all duration-200 scale-95 opacity-0">
                            <!-- Header -->
                            <div class="p-4 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-t-xl">
                                <div class="flex items-center gap-2">
                                    <span class="text-lg">üì¶</span>
                                    <h4 class="text-sm font-semibold text-gray-700">Select Item</h4>
                                </div>
                            </div>
                            
                            <!-- Item List -->
                            <div id="item-options" class="max-h-52 overflow-y-auto">
                                <!-- Item options will be populated here -->
                            </div>
                            
                            <!-- Footer -->
                            <div class="p-3 border-t border-gray-100 bg-gradient-to-r from-gray-50 to-slate-50 rounded-b-xl">
                                <div class="flex items-center justify-center gap-4 text-xs text-gray-500">
                                    <span class="flex items-center gap-1">
                                        <span class="bg-blue-100 text-blue-600 px-1.5 py-0.5 rounded font-mono">‚å®Ô∏è</span>
                                        Type to search
                                    </span>
                                    <span class="flex items-center gap-1">
                                        <span class="bg-green-100 text-green-600 px-1.5 py-0.5 rounded font-mono">‚Üë‚Üì</span>
                                        Navigate
                                    </span>
                                    <span class="flex items-center gap-1">
                                        <span class="bg-purple-100 text-purple-600 px-1.5 py-0.5 rounded font-mono">‚èé</span>
                                        Select
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <select id="transaction-type" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Transaction Type</option>
                        <option value="in">Stock In</option>
                        <option value="out">Stock Out</option>
                    </select>
                    <input type="number" id="transaction-quantity" placeholder="Quantity" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <input type="text" id="transaction-notes" placeholder="Notes (optional)" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div class="mt-4 flex gap-3">
                    <button onclick="recordTransaction()" id="save-transaction-btn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                        üíæ Record Transaction
                    </button>
                    <button onclick="updateTransaction()" id="update-transaction-btn" class="hidden bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                        ‚úÖ Update Transaction
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Transaction History</h3>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200">
                                <th class="text-left py-3 px-4 font-medium text-gray-700">Date</th>
                                <th class="text-left py-3 px-4 font-medium text-gray-700">Item</th>
                                <th class="text-left py-3 px-4 font-medium text-gray-700">Type</th>
                                <th class="text-left py-3 px-4 font-medium text-gray-700">Quantity</th>
                                <th class="text-left py-3 px-4 font-medium text-gray-700">Notes</th>
                                <th class="text-left py-3 px-4 font-medium text-gray-700">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="transactions-table">
                            <tr>
                                <td colspan="6" class="text-center py-8 text-gray-500">No transactions recorded yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Low Stock Tab -->
        <div id="lowstock" class="tab-content hidden">
            <!-- Low Stock Header -->
            <div class="bg-gradient-to-br from-red-50 to-rose-100 rounded-xl shadow-lg p-6 mb-6 border-l-4 border-red-500">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-semibold text-red-800 flex items-center gap-2">
                        <span class="bg-red-100 p-2 rounded-full">‚ö†Ô∏è</span>
                        Low Stock Items - Immediate Action Required
                    </h3>
                    <span class="bg-red-500 text-white px-4 py-2 rounded-full text-sm font-medium" id="lowstock-count">0</span>
                </div>
                
                <div class="mt-4 flex items-center justify-between bg-red-100 rounded-lg p-3">
                    <div class="flex items-center gap-2 text-red-700">
                        <span class="text-lg">üí°</span>
                        <span class="text-sm font-medium">Quick Actions:</span>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="showTab('transactions')" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all transform hover:scale-105">
                            üìà Add Stock
                        </button>
                        <button onclick="exportLowStockReport()" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all transform hover:scale-105">
                            üìä Export Report
                        </button>
                        <button onclick="refreshLowStock()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all transform hover:scale-105">
                            üîÑ Refresh
                        </button>
                    </div>
                </div>
            </div>

            <!-- Low Stock Filters -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                    <span class="bg-gray-100 p-2 rounded-full">üîç</span>
                    Filter Low Stock Items
                </h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">üìÇ Category</label>
                        <select id="lowstock-category-filter" onchange="filterLowStockItems()" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‚ö†Ô∏è Urgency Level</label>
                        <select id="lowstock-urgency-filter" onchange="filterLowStockItems()" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">All Levels</option>
                            <option value="critical">üö® Critical (Out of Stock)</option>
                            <option value="high">‚ö†Ô∏è High (Very Low)</option>
                            <option value="medium">‚ö° Medium (Low)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">üîç Search Items</label>
                        <input type="text" id="lowstock-search" placeholder="Search by item name..." oninput="filterLowStockItems()" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>
            </div>

            <!-- Low Stock Statistics -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-gradient-to-r from-red-50 to-rose-50 rounded-xl p-4 border-l-4 border-red-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-600 text-xs font-medium uppercase tracking-wide">Critical Items</p>
                            <p class="text-xl font-bold text-red-800" id="critical-count">0</p>
                        </div>
                        <div class="bg-red-100 p-2 rounded-full">
                            <span class="text-lg">üö®</span>
                        </div>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-orange-50 to-amber-50 rounded-xl p-4 border-l-4 border-orange-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-orange-600 text-xs font-medium uppercase tracking-wide">High Priority</p>
                            <p class="text-xl font-bold text-orange-800" id="high-count">0</p>
                        </div>
                        <div class="bg-orange-100 p-2 rounded-full">
                            <span class="text-lg">‚ö†Ô∏è</span>
                        </div>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-yellow-50 to-amber-50 rounded-xl p-4 border-l-4 border-yellow-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-yellow-600 text-xs font-medium uppercase tracking-wide">Medium Priority</p>
                            <p class="text-xl font-bold text-yellow-800" id="medium-count">0</p>
                        </div>
                        <div class="bg-yellow-100 p-2 rounded-full">
                            <span class="text-lg">‚ö°</span>
                        </div>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border-l-4 border-blue-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-600 text-xs font-medium uppercase tracking-wide">Reorder Value</p>
                            <p class="text-xl font-bold text-blue-800" id="reorder-value">‚Çπ0</p>
                        </div>
                        <div class="bg-blue-100 p-2 rounded-full">
                            <span class="text-lg">üí∞</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Low Stock Items Grid -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-6">
                    <h4 class="text-lg font-semibold text-gray-800 flex items-center gap-2">
                        <span class="bg-red-100 p-2 rounded-full">üì¶</span>
                        Low Stock Items
                    </h4>
                    <div class="flex gap-2">
                        <button onclick="bulkAddStock()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all transform hover:scale-105">
                            ‚ûï Bulk Add Stock
                        </button>
                        <button onclick="printLowStockReport()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all transform hover:scale-105">
                            üñ®Ô∏è Print Report
                        </button>
                    </div>
                </div>
                
                <div id="lowstock-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Low stock items will be populated here -->
                </div>
            </div>
        </div>

        <!-- Ledger Tab -->
        <div id="ledger" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
                        <span class="bg-blue-100 p-2 rounded-full">üìä</span>
                        Stock Ledger
                    </h3>
                    <button onclick="printLedger()" class="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white px-6 py-2 rounded-xl font-medium transition-all transform hover:scale-105 shadow-lg flex items-center gap-2">
                        <span>üñ®Ô∏è</span>
                        Print Ledger
                    </button>
                </div>
                
                <!-- Enhanced Filters -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6 p-4 bg-gradient-to-r from-gray-50 to-slate-50 rounded-xl border">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">üì¶ Select Item</label>
                        <div class="relative">
                            <input type="text" id="ledger-filter-input" placeholder="Type to search items..." class="w-full border border-gray-300 rounded-lg px-4 py-2 pr-12 focus:ring-2 focus:ring-blue-500 focus:border-transparent" autocomplete="off" oninput="handleLedgerItemInput()" onfocus="showLedgerItemDropdown()" onkeydown="handleLedgerItemKeydown(event)">
                            <input type="hidden" id="ledger-filter" value="">
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                                <button type="button" onclick="toggleLedgerItemDropdown()" class="text-gray-400 hover:text-gray-600">
                                    <svg id="ledger-dropdown-arrow" class="w-5 h-5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                            </div>
                            <div id="ledger-item-dropdown" class="absolute z-20 w-full bg-white border border-gray-200 rounded-xl mt-2 shadow-2xl hidden backdrop-blur-sm transform transition-all duration-200 scale-95 opacity-0">
                                <!-- Header -->
                                <div class="p-4 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-t-xl">
                                    <div class="flex items-center gap-2">
                                        <span class="text-lg">üì¶</span>
                                        <h4 class="text-sm font-semibold text-gray-700">Select Item for Ledger</h4>
                                    </div>
                                </div>
                                
                                <!-- Item List -->
                                <div id="ledger-item-options" class="max-h-52 overflow-y-auto">
                                    <!-- Item options will be populated here -->
                                </div>
                                
                                <!-- Footer -->
                                <div class="p-3 border-t border-gray-100 bg-gradient-to-r from-gray-50 to-slate-50 rounded-b-xl">
                                    <div class="flex items-center justify-center gap-4 text-xs text-gray-500">
                                        <span class="flex items-center gap-1">
                                            <span class="bg-blue-100 text-blue-600 px-1.5 py-0.5 rounded font-mono">‚å®Ô∏è</span>
                                            Type to search
                                        </span>
                                        <span class="flex items-center gap-1">
                                            <span class="bg-green-100 text-green-600 px-1.5 py-0.5 rounded font-mono">‚Üë‚Üì</span>
                                            Navigate
                                        </span>
                                        <span class="flex items-center gap-1">
                                            <span class="bg-purple-100 text-purple-600 px-1.5 py-0.5 rounded font-mono">‚èé</span>
                                            Select
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">üìÖ From Date</label>
                        <input type="date" id="ledger-from-date" onchange="filterLedger()" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">üìÖ To Date</label>
                        <input type="date" id="ledger-to-date" onchange="filterLedger()" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div class="flex items-end">
                        <button onclick="clearLedgerFilters()" class="w-full bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center justify-center gap-2">
                            <span>üîÑ</span>
                            Clear Filters
                        </button>
                    </div>
                </div>
                
                <!-- Ledger Summary -->
                <div id="ledger-summary" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <!-- Summary cards will be populated here -->
                </div>
                

                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200">
                                <th class="text-left py-3 px-4 font-medium text-gray-700">Date</th>
                                <th class="text-left py-3 px-4 font-medium text-gray-700">Item</th>
                                <th class="text-left py-3 px-4 font-medium text-gray-700">Transaction</th>
                                <th class="text-left py-3 px-4 font-medium text-gray-700">In</th>
                                <th class="text-left py-3 px-4 font-medium text-gray-700">Out</th>
                                <th class="text-left py-3 px-4 font-medium text-gray-700">Balance</th>
                            </tr>
                        </thead>
                        <tbody id="ledger-table">
                            <tr>
                                <td colspan="6" class="text-center py-8 text-gray-500">No ledger entries yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let items = JSON.parse(localStorage.getItem('stockItems') || '[]');
        let transactions = JSON.parse(localStorage.getItem('stockTransactions') || '[]');
        let categories = JSON.parse(localStorage.getItem('stockCategories') || '["Electronics", "Clothing", "Food & Beverages", "Books", "Home & Garden"]');

        // Initialize the application
        function init() {
            updateDashboard();
            renderItems();
            renderTransactions();
            renderLedger();
            updateTransactionItemSelect();
            updateLedgerFilter();
        }

        // Category management functions
        let selectedCategoryIndex = -1;
        let filteredCategoriesCache = [];

        // Item dropdown management functions
        let selectedItemIndex = -1;
        let filteredItemsCache = [];

        // Ledger item dropdown management functions
        let selectedLedgerItemIndex = -1;
        let filteredLedgerItemsCache = [];

        function toggleItemDropdown() {
            const dropdown = document.getElementById('item-dropdown');
            const arrow = document.getElementById('item-dropdown-arrow');
            
            if (dropdown.classList.contains('hidden')) {
                showItemDropdown();
                arrow.style.transform = 'rotate(180deg)';
            } else {
                dropdown.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
                selectedItemIndex = -1;
            }
        }

        function showItemDropdown() {
            const input = document.getElementById('transaction-item');
            const searchTerm = input.value;
            showItemOptions(searchTerm);
            document.getElementById('item-dropdown-arrow').style.transform = 'rotate(180deg)';
        }

        function handleItemInput() {
            const input = document.getElementById('transaction-item');
            const searchTerm = input.value;
            showItemOptions(searchTerm);
            selectedItemIndex = -1;
            
            // Clear hidden field if input is cleared
            if (!searchTerm.trim()) {
                document.getElementById('transaction-item-id').value = '';
            }
        }

        function handleItemKeydown(event) {
            const dropdown = document.getElementById('item-dropdown');
            
            if (dropdown.classList.contains('hidden')) {
                if (event.key === 'ArrowDown' || event.key === 'Enter') {
                    showItemDropdown();
                    event.preventDefault();
                }
                return;
            }

            switch (event.key) {
                case 'ArrowDown':
                    event.preventDefault();
                    selectedItemIndex = Math.min(selectedItemIndex + 1, filteredItemsCache.length - 1);
                    highlightSelectedItem();
                    break;
                case 'ArrowUp':
                    event.preventDefault();
                    selectedItemIndex = Math.max(selectedItemIndex - 1, -1);
                    highlightSelectedItem();
                    break;
                case 'Enter':
                    event.preventDefault();
                    if (selectedItemIndex >= 0 && selectedItemIndex < filteredItemsCache.length) {
                        selectItem(filteredItemsCache[selectedItemIndex]);
                    }
                    break;
                case 'Escape':
                    dropdown.classList.add('hidden');
                    document.getElementById('item-dropdown-arrow').style.transform = 'rotate(0deg)';
                    selectedItemIndex = -1;
                    break;
            }
        }

        function highlightSelectedItem() {
            const itemElements = document.querySelectorAll('.item-option');
            itemElements.forEach((item, index) => {
                if (index === selectedItemIndex) {
                    item.classList.add('bg-gradient-to-r', 'from-blue-100', 'to-indigo-100', 'border-l-4', 'border-blue-500');
                    item.style.transform = 'translateX(4px)';
                } else {
                    item.classList.remove('bg-gradient-to-r', 'from-blue-100', 'to-indigo-100', 'border-l-4', 'border-blue-500');
                    item.style.transform = 'translateX(0)';
                }
            });
        }

        function showItemOptions(searchTerm = '') {
            const dropdown = document.getElementById('item-dropdown');
            const optionsContainer = document.getElementById('item-options');
            
            const filteredItems = items.filter(item => 
                item.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                item.category.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            // Cache filtered items for keyboard navigation
            filteredItemsCache = filteredItems;
            selectedItemIndex = -1;
            
            if (filteredItems.length === 0 && searchTerm) {
                optionsContainer.innerHTML = `
                    <div class="p-6 text-gray-500 text-sm text-center">
                        <div class="mb-3">
                            <span class="text-2xl">üîç</span>
                        </div>
                        <p class="mb-3">‡§ï‡•ã‡§à ‡§Ü‡§á‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</p>
                        <p class="text-xs text-gray-400">‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§≤‡§ó ‡§®‡§æ‡§Æ ‡§∏‡•á ‡§ñ‡•ã‡§ú‡•á‡§Ç</p>
                    </div>
                `;
            } else if (filteredItems.length === 0) {
                optionsContainer.innerHTML = `
                    <div class="p-6 text-gray-500 text-sm text-center">
                        <div class="mb-2">
                            <span class="text-2xl">üì¶</span>
                        </div>
                        <p>‡§ï‡•ã‡§à ‡§Ü‡§á‡§ü‡§Æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à</p>
                        <p class="text-xs text-gray-400 mt-1">‡§™‡§π‡§≤‡•á ‡§Ü‡§á‡§ü‡§Æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</p>
                    </div>
                `;
            } else {
                optionsContainer.innerHTML = filteredItems.map((item, index) => {
                    const stockStatus = item.quantity <= item.minStock ? 'text-red-600' : 'text-green-600';
                    const stockIcon = item.quantity <= item.minStock ? '‚ö†Ô∏è' : '‚úÖ';
                    
                    return `
                        <div class="item-option p-4 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 cursor-pointer text-sm border-b border-gray-100 last:border-b-0 transition-all duration-200" 
                             onclick="selectItem(${JSON.stringify(item).replace(/"/g, '&quot;')})" 
                             onmouseover="selectedItemIndex = ${index}; highlightSelectedItem()">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="font-medium text-gray-800">${item.name}</span>
                                        <span class="text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full">${item.category}</span>
                                    </div>
                                    <div class="flex items-center gap-3 text-xs text-gray-500">
                                        <span class="flex items-center gap-1">
                                            <span class="${stockStatus}">${stockIcon}</span>
                                            <span class="${stockStatus} font-medium">Stock: ${item.quantity}</span>
                                        </span>
                                        <span>Price: ‚Çπ${item.price.toFixed(2)}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            // Show dropdown with animation
            dropdown.classList.remove('hidden');
            dropdown.style.transform = 'scale(0.95)';
            dropdown.style.opacity = '0';
            
            setTimeout(() => {
                dropdown.style.transform = 'scale(1)';
                dropdown.style.opacity = '1';
            }, 10);
        }

        function selectItem(item) {
            document.getElementById('transaction-item').value = item.name;
            document.getElementById('transaction-item-id').value = item.id;
            document.getElementById('item-dropdown').classList.add('hidden');
            document.getElementById('item-dropdown-arrow').style.transform = 'rotate(0deg)';
        }

        // Setup item input functionality
        function setupItemInput() {
            const input = document.getElementById('transaction-item');
            const dropdown = document.getElementById('item-dropdown');
            const arrow = document.getElementById('item-dropdown-arrow');
            
            // Hide dropdown when clicking outside
            document.addEventListener('click', function(e) {
                const itemContainer = input.closest('.relative');
                if (!itemContainer.contains(e.target)) {
                    dropdown.classList.add('hidden');
                    arrow.style.transform = 'rotate(0deg)';
                    selectedItemIndex = -1;
                }
            });
        }

        // Ledger item dropdown functions
        function toggleLedgerItemDropdown() {
            const dropdown = document.getElementById('ledger-item-dropdown');
            const arrow = document.getElementById('ledger-dropdown-arrow');
            
            if (dropdown.classList.contains('hidden')) {
                showLedgerItemDropdown();
                arrow.style.transform = 'rotate(180deg)';
            } else {
                dropdown.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
                selectedLedgerItemIndex = -1;
            }
        }

        function showLedgerItemDropdown() {
            const input = document.getElementById('ledger-filter-input');
            const searchTerm = input.value;
            showLedgerItemOptions(searchTerm);
            document.getElementById('ledger-dropdown-arrow').style.transform = 'rotate(180deg)';
        }

        function handleLedgerItemInput() {
            const input = document.getElementById('ledger-filter-input');
            const searchTerm = input.value;
            showLedgerItemOptions(searchTerm);
            selectedLedgerItemIndex = -1;
            
            // Clear hidden field if input is cleared
            if (!searchTerm.trim()) {
                document.getElementById('ledger-filter').value = '';
                filterLedger();
            }
        }

        function handleLedgerItemKeydown(event) {
            const dropdown = document.getElementById('ledger-item-dropdown');
            
            if (dropdown.classList.contains('hidden')) {
                if (event.key === 'ArrowDown' || event.key === 'Enter') {
                    showLedgerItemDropdown();
                    event.preventDefault();
                }
                return;
            }

            switch (event.key) {
                case 'ArrowDown':
                    event.preventDefault();
                    selectedLedgerItemIndex = Math.min(selectedLedgerItemIndex + 1, filteredLedgerItemsCache.length - 1);
                    highlightSelectedLedgerItem();
                    break;
                case 'ArrowUp':
                    event.preventDefault();
                    selectedLedgerItemIndex = Math.max(selectedLedgerItemIndex - 1, -1);
                    highlightSelectedLedgerItem();
                    break;
                case 'Enter':
                    event.preventDefault();
                    if (selectedLedgerItemIndex >= 0 && selectedLedgerItemIndex < filteredLedgerItemsCache.length) {
                        selectLedgerItem(filteredLedgerItemsCache[selectedLedgerItemIndex]);
                    }
                    break;
                case 'Escape':
                    dropdown.classList.add('hidden');
                    document.getElementById('ledger-dropdown-arrow').style.transform = 'rotate(0deg)';
                    selectedLedgerItemIndex = -1;
                    break;
            }
        }

        function highlightSelectedLedgerItem() {
            const itemElements = document.querySelectorAll('.ledger-item-option');
            itemElements.forEach((item, index) => {
                if (index === selectedLedgerItemIndex) {
                    item.classList.add('bg-gradient-to-r', 'from-blue-100', 'to-indigo-100', 'border-l-4', 'border-blue-500');
                    item.style.transform = 'translateX(4px)';
                } else {
                    item.classList.remove('bg-gradient-to-r', 'from-blue-100', 'to-indigo-100', 'border-l-4', 'border-blue-500');
                    item.style.transform = 'translateX(0)';
                }
            });
        }

        function showLedgerItemOptions(searchTerm = '') {
            const dropdown = document.getElementById('ledger-item-dropdown');
            const optionsContainer = document.getElementById('ledger-item-options');
            
            // Add "All Items" option
            const allItemsOption = { id: '', name: 'All Items', category: 'Filter', quantity: 'All', isAllOption: true };
            
            const filteredItems = [allItemsOption, ...items.filter(item => 
                item.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                item.category.toLowerCase().includes(searchTerm.toLowerCase())
            )];
            
            // Cache filtered items for keyboard navigation
            filteredLedgerItemsCache = filteredItems;
            selectedLedgerItemIndex = -1;
            
            if (filteredItems.length === 1 && searchTerm) { // Only "All Items" option
                optionsContainer.innerHTML = `
                    <div class="p-6 text-gray-500 text-sm text-center">
                        <div class="mb-3">
                            <span class="text-2xl">üîç</span>
                        </div>
                        <p class="mb-3">‡§ï‡•ã‡§à ‡§Ü‡§á‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</p>
                        <p class="text-xs text-gray-400">‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§≤‡§ó ‡§®‡§æ‡§Æ ‡§∏‡•á ‡§ñ‡•ã‡§ú‡•á‡§Ç</p>
                    </div>
                `;
            } else {
                optionsContainer.innerHTML = filteredItems.map((item, index) => {
                    if (item.isAllOption) {
                        return `
                            <div class="ledger-item-option p-4 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 cursor-pointer text-sm border-b border-gray-100 transition-all duration-200" 
                                 onclick="selectLedgerItem(${JSON.stringify(item).replace(/"/g, '&quot;')})" 
                                 onmouseover="selectedLedgerItemIndex = ${index}; highlightSelectedLedgerItem()">
                                <div class="flex items-center justify-between">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <span class="font-medium text-blue-600">üìä ${item.name}</span>
                                            <span class="text-xs bg-blue-100 text-blue-600 px-2 py-0.5 rounded-full">Show All</span>
                                        </div>
                                        <div class="text-xs text-gray-500">
                                            <span>View complete ledger for all items</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    } else {
                        const stockStatus = item.quantity <= item.minStock ? 'text-red-600' : 'text-green-600';
                        const stockIcon = item.quantity <= item.minStock ? '‚ö†Ô∏è' : '‚úÖ';
                        
                        return `
                            <div class="ledger-item-option p-4 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 cursor-pointer text-sm border-b border-gray-100 last:border-b-0 transition-all duration-200" 
                                 onclick="selectLedgerItem(${JSON.stringify(item).replace(/"/g, '&quot;')})" 
                                 onmouseover="selectedLedgerItemIndex = ${index}; highlightSelectedLedgerItem()">
                                <div class="flex items-center justify-between">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <span class="font-medium text-gray-800">${item.name}</span>
                                            <span class="text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full">${item.category}</span>
                                        </div>
                                        <div class="flex items-center gap-3 text-xs text-gray-500">
                                            <span class="flex items-center gap-1">
                                                <span class="${stockStatus}">${stockIcon}</span>
                                                <span class="${stockStatus} font-medium">Stock: ${item.quantity}</span>
                                            </span>
                                            <span>Price: ‚Çπ${item.price.toFixed(2)}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                }).join('');
            }
            
            // Show dropdown with animation
            dropdown.classList.remove('hidden');
            dropdown.style.transform = 'scale(0.95)';
            dropdown.style.opacity = '0';
            
            setTimeout(() => {
                dropdown.style.transform = 'scale(1)';
                dropdown.style.opacity = '1';
            }, 10);
        }

        function selectLedgerItem(item) {
            if (item.isAllOption) {
                document.getElementById('ledger-filter-input').value = 'All Items';
                document.getElementById('ledger-filter').value = '';
            } else {
                document.getElementById('ledger-filter-input').value = item.name;
                document.getElementById('ledger-filter').value = item.id;
            }
            
            document.getElementById('ledger-item-dropdown').classList.add('hidden');
            document.getElementById('ledger-dropdown-arrow').style.transform = 'rotate(0deg)';
            
            // Trigger filter update
            filterLedger();
        }

        // Setup ledger item input functionality
        function setupLedgerItemInput() {
            const input = document.getElementById('ledger-filter-input');
            const dropdown = document.getElementById('ledger-item-dropdown');
            const arrow = document.getElementById('ledger-dropdown-arrow');
            
            // Hide dropdown when clicking outside
            document.addEventListener('click', function(e) {
                const ledgerContainer = input.closest('.relative');
                if (!ledgerContainer.contains(e.target)) {
                    dropdown.classList.add('hidden');
                    arrow.style.transform = 'rotate(0deg)';
                    selectedLedgerItemIndex = -1;
                }
            });
        }

        function toggleCategoryDropdown() {
            const dropdown = document.getElementById('category-dropdown');
            const arrow = document.getElementById('dropdown-arrow');
            
            if (dropdown.classList.contains('hidden')) {
                showCategoryDropdown();
                arrow.style.transform = 'rotate(180deg)';
            } else {
                dropdown.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
                cancelAddCategory(); // Hide add form when closing
                selectedCategoryIndex = -1;
            }
        }

        function showCategoryDropdown() {
            const input = document.getElementById('item-category');
            const searchTerm = input.value;
            showCategoryOptions(searchTerm);
            document.getElementById('dropdown-arrow').style.transform = 'rotate(180deg)';
        }

        function handleCategoryInput() {
            const input = document.getElementById('item-category');
            const searchTerm = input.value;
            showCategoryOptions(searchTerm);
            selectedCategoryIndex = -1;
        }

        function handleCategoryKeydown(event) {
            const dropdown = document.getElementById('category-dropdown');
            
            if (dropdown.classList.contains('hidden')) {
                if (event.key === 'ArrowDown' || event.key === 'Enter') {
                    showCategoryDropdown();
                    event.preventDefault();
                }
                return;
            }

            switch (event.key) {
                case 'ArrowDown':
                    event.preventDefault();
                    selectedCategoryIndex = Math.min(selectedCategoryIndex + 1, filteredCategoriesCache.length - 1);
                    highlightSelectedCategory();
                    break;
                case 'ArrowUp':
                    event.preventDefault();
                    selectedCategoryIndex = Math.max(selectedCategoryIndex - 1, -1);
                    highlightSelectedCategory();
                    break;
                case 'Enter':
                    event.preventDefault();
                    if (selectedCategoryIndex >= 0 && selectedCategoryIndex < filteredCategoriesCache.length) {
                        selectCategory(filteredCategoriesCache[selectedCategoryIndex]);
                    } else {
                        // If no selection and input has text, create new category
                        const input = document.getElementById('item-category');
                        if (input.value.trim() && !categories.includes(input.value.trim())) {
                            createNewCategoryFromInput();
                        }
                    }
                    break;
                case 'Escape':
                    dropdown.classList.add('hidden');
                    document.getElementById('dropdown-arrow').style.transform = 'rotate(0deg)';
                    selectedCategoryIndex = -1;
                    break;
            }
        }

        function highlightSelectedCategory() {
            const categoryItems = document.querySelectorAll('.category-item');
            categoryItems.forEach((item, index) => {
                if (index === selectedCategoryIndex) {
                    item.classList.add('bg-gradient-to-r', 'from-blue-100', 'to-indigo-100', 'border-l-4', 'border-blue-500');
                    item.style.transform = 'translateX(4px)';
                } else {
                    item.classList.remove('bg-gradient-to-r', 'from-blue-100', 'to-indigo-100', 'border-l-4', 'border-blue-500');
                    item.style.transform = 'translateX(0)';
                }
            });
        }

        function createNewCategoryFromInput() {
            const input = document.getElementById('item-category');
            const categoryName = input.value.trim();
            
            if (!categoryName) return;
            
            if (categories.includes(categoryName)) {
                selectCategory(categoryName);
                return;
            }
            
            categories.push(categoryName);
            localStorage.setItem('stockCategories', JSON.stringify(categories));
            showNotification(`‡§®‡§à ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä "${categoryName}" ‡§ú‡•ã‡§°‡§º‡•Ä ‡§ó‡§à`, 'success');
            selectCategory(categoryName);
        }

        function showCategoryOptions(searchTerm = '') {
            const dropdown = document.getElementById('category-dropdown');
            const optionsContainer = document.getElementById('category-options');
            
            const filteredCategories = categories.filter(cat => 
                cat.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            // Cache filtered categories for keyboard navigation
            filteredCategoriesCache = filteredCategories;
            selectedCategoryIndex = -1;
            
            if (filteredCategories.length === 0 && searchTerm) {
                optionsContainer.innerHTML = `
                    <div class="p-6 text-gray-500 text-sm text-center">
                        <div class="mb-3">
                            <span class="text-2xl">üîç</span>
                        </div>
                        <p class="mb-3">‡§ï‡•ã‡§à ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä</p>
                        <button onclick="createNewCategoryFromInput()" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-4 py-2 rounded-lg text-xs font-semibold transition-all transform hover:scale-105 shadow-md">
                            ‚ú® "${searchTerm}" ‡§ï‡•ã ‡§®‡§à ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
                        </button>
                    </div>
                `;
            } else if (filteredCategories.length === 0) {
                optionsContainer.innerHTML = `
                    <div class="p-6 text-gray-500 text-sm text-center">
                        <div class="mb-2">
                            <span class="text-2xl">üìÇ</span>
                        </div>
                        <p>‡§ï‡•ã‡§à ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä</p>
                    </div>
                `;
            } else {
                optionsContainer.innerHTML = filteredCategories.map((category, index) => `
                    <div class="category-item p-4 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 cursor-pointer text-sm border-b border-gray-100 last:border-b-0 flex items-center justify-between group transition-all duration-200" 
                         onclick="selectCategory('${category}')" 
                         oncontextmenu="showCategoryContextMenu(event, '${category}')"
                         onmouseover="selectedCategoryIndex = ${index}; highlightSelectedCategory()">
                        <div class="flex items-center gap-3">
                            <span class="text-lg">üìÅ</span>
                            <span class="flex-1 font-medium">${category}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="event.stopPropagation(); editCategoryInline('${category}')" 
                                    class="opacity-0 group-hover:opacity-100 text-blue-500 hover:text-blue-700 text-xs px-2 py-1 rounded-lg transition-all transform hover:scale-110 bg-blue-50 hover:bg-blue-100" 
                                    title="Edit">
                                ‚úèÔ∏è
                            </button>
                            <button onclick="event.stopPropagation(); deleteCategoryConfirm('${category}')" 
                                    class="opacity-0 group-hover:opacity-100 text-red-500 hover:text-red-700 text-xs px-2 py-1 rounded-lg transition-all transform hover:scale-110 bg-red-50 hover:bg-red-100" 
                                    title="Delete">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            // Show dropdown with animation
            dropdown.classList.remove('hidden');
            dropdown.style.transform = 'scale(0.95)';
            dropdown.style.opacity = '0';
            
            setTimeout(() => {
                dropdown.style.transform = 'scale(1)';
                dropdown.style.opacity = '1';
            }, 10);
        }

        function selectCategory(categoryName) {
            document.getElementById('item-category').value = categoryName;
            document.getElementById('category-dropdown').classList.add('hidden');
            document.getElementById('dropdown-arrow').style.transform = 'rotate(0deg)';
            cancelAddCategory();
        }

        function showAddCategoryInline() {
            const form = document.getElementById('add-category-form');
            const input = document.getElementById('new-category-name');
            
            form.classList.remove('hidden');
            input.focus();
            input.value = '';
        }

        function cancelAddCategory() {
            const form = document.getElementById('add-category-form');
            form.classList.add('hidden');
            document.getElementById('new-category-name').value = '';
        }

        function addNewCategory() {
            const categoryName = document.getElementById('new-category-name').value.trim();
            
            if (!categoryName) {
                showNotification('‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≠‡§∞‡•á‡§Ç', 'error');
                return;
            }
            
            if (categories.includes(categoryName)) {
                showNotification('‡§Ø‡§π ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•à', 'error');
                return;
            }
            
            categories.push(categoryName);
            localStorage.setItem('stockCategories', JSON.stringify(categories));
            
            showNotification(`${categoryName} ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ú‡•ã‡§°‡§º‡•Ä ‡§ó‡§à`, 'success');
            
            // Auto-select the new category
            document.getElementById('item-category').value = categoryName;
            
            // Refresh dropdown and close add form
            showCategoryOptions();
            cancelAddCategory();
        }

        function editCategoryInline(oldName) {
            const newName = prompt(`‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ï‡§æ ‡§®‡§Ø‡§æ ‡§®‡§æ‡§Æ ‡§≠‡§∞‡•á‡§Ç:`, oldName);
            
            if (!newName || newName.trim() === '') {
                return;
            }
            
            const trimmedName = newName.trim();
            
            if (trimmedName === oldName) {
                return;
            }
            
            if (categories.includes(trimmedName)) {
                showNotification('‡§Ø‡§π ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•à', 'error');
                return;
            }
            
            // Check if any items use this category
            const itemsUsingCategory = items.filter(item => item.category === oldName);
            
            // Update category in categories array
            const index = categories.indexOf(oldName);
            if (index > -1) {
                categories[index] = trimmedName;
            }
            
            // Update category in all items that use it
            itemsUsingCategory.forEach(item => {
                item.category = trimmedName;
            });
            
            // Save changes
            localStorage.setItem('stockCategories', JSON.stringify(categories));
            localStorage.setItem('stockItems', JSON.stringify(items));
            
            showNotification(`‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä "${oldName}" ‡§ï‡•ã "${trimmedName}" ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ`, 'success');
            
            // Update current selection if it was the edited category
            const currentCategory = document.getElementById('item-category').value;
            if (currentCategory === oldName) {
                document.getElementById('item-category').value = trimmedName;
            }
            
            // Refresh dropdown and update other parts
            showCategoryOptions();
            init();
        }

        function deleteCategoryConfirm(categoryName) {
            // Check if any items use this category
            const itemsUsingCategory = items.filter(item => item.category === categoryName);
            
            showDeleteConfirmation({
                title: 'Delete Category',
                itemName: categoryName,
                icon: 'üìÇ',
                message: `‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ "${categoryName}" ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ï‡•ã ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?`,
                warning: itemsUsingCategory.length > 0 ? `‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä: ‡§á‡§∏ ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§Æ‡•á‡§Ç ${itemsUsingCategory.length} ‡§Ü‡§á‡§ü‡§Æ ‡§π‡•à‡§Ç‡•§ ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡§®‡•á ‡§∏‡•á ‡§Ø‡•á ‡§Ü‡§á‡§ü‡§Æ "Uncategorized" ‡§Æ‡•á‡§Ç ‡§ö‡§≤‡•á ‡§ú‡§æ‡§è‡§Ç‡§ó‡•á‡•§` : null,
                onConfirm: () => {
                    // Move items to "Uncategorized" if category is deleted
                    if (itemsUsingCategory.length > 0) {
                        if (!categories.includes('Uncategorized')) {
                            categories.push('Uncategorized');
                        }
                        
                        itemsUsingCategory.forEach(item => {
                            item.category = 'Uncategorized';
                        });
                        
                        localStorage.setItem('stockItems', JSON.stringify(items));
                    }
                    
                    // Remove category from list
                    categories = categories.filter(cat => cat !== categoryName);
                    localStorage.setItem('stockCategories', JSON.stringify(categories));
                    
                    // Clear selection if deleted category was selected
                    const currentCategory = document.getElementById('item-category').value;
                    if (currentCategory === categoryName) {
                        document.getElementById('item-category').value = '';
                    }
                    
                    showNotification(`${categoryName} ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡•Ä ‡§ó‡§à`, 'success');
                    
                    // Refresh dropdown and update other parts
                    showCategoryOptions();
                    init();
                }
            });
        }

        function showCategoryContextMenu(event, categoryName) {
            event.preventDefault();
            
            const contextMenu = document.createElement('div');
            contextMenu.className = 'fixed bg-white border border-gray-300 rounded-lg shadow-lg py-2 z-30';
            contextMenu.style.left = event.pageX + 'px';
            contextMenu.style.top = event.pageY + 'px';
            
            contextMenu.innerHTML = `
                <button onclick="editCategoryInline('${categoryName}'); removeContextMenu()" class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">
                    ‚úèÔ∏è Edit Category
                </button>
                <button onclick="deleteCategoryConfirm('${categoryName}'); removeContextMenu()" class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 text-red-600">
                    üóëÔ∏è Delete Category
                </button>
            `;
            
            document.body.appendChild(contextMenu);
            
            // Remove context menu when clicking elsewhere
            setTimeout(() => {
                document.addEventListener('click', removeContextMenu, { once: true });
            }, 100);
        }

        function removeContextMenu() {
            const contextMenus = document.querySelectorAll('.fixed.bg-white.border');
            contextMenus.forEach(menu => {
                if (menu.innerHTML.includes('Edit Category')) {
                    menu.remove();
                }
            });
        }

        function showAddCategoryModal() {
            const modal = document.getElementById('category-modal');
            const modalContent = document.getElementById('modal-content');
            
            modal.classList.remove('hidden');
            
            // Animate modal appearance
            setTimeout(() => {
                modalContent.style.transform = 'scale(1)';
                modalContent.style.opacity = '1';
            }, 10);
            
            renderModalCategories();
        }

        function hideCategoryModal() {
            const modal = document.getElementById('category-modal');
            const modalContent = document.getElementById('modal-content');
            
            // Animate modal disappearance
            modalContent.style.transform = 'scale(0.95)';
            modalContent.style.opacity = '0';
            
            setTimeout(() => {
                modal.classList.add('hidden');
                document.getElementById('new-category-input').value = '';
            }, 300);
        }

        function addCategoryFromModal() {
            const categoryName = document.getElementById('new-category-input').value.trim();
            
            if (!categoryName) {
                showNotification('‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≠‡§∞‡•á‡§Ç', 'error');
                return;
            }
            
            if (categories.includes(categoryName)) {
                showNotification('‡§Ø‡§π ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•à', 'error');
                return;
            }
            
            categories.push(categoryName);
            localStorage.setItem('stockCategories', JSON.stringify(categories));
            document.getElementById('new-category-input').value = '';
            
            showNotification(`${categoryName} ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ú‡•ã‡§°‡§º‡•Ä ‡§ó‡§à`, 'success');
            renderModalCategories();
            
            // Auto-select the new category
            document.getElementById('item-category').value = categoryName;
            hideCategoryModal();
        }

        function deleteCategory(categoryName) {
            // Check if any items use this category
            const itemsUsingCategory = items.filter(item => item.category === categoryName);
            
            showDeleteConfirmation({
                title: 'Delete Category',
                itemName: categoryName,
                icon: 'üìÇ',
                message: `‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ${categoryName} ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ï‡•ã ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?`,
                warning: itemsUsingCategory.length > 0 ? `‡§á‡§∏ ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§Æ‡•á‡§Ç ${itemsUsingCategory.length} ‡§Ü‡§á‡§ü‡§Æ ‡§π‡•à‡§Ç‡•§ ‡§™‡§π‡§≤‡•á ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§` : null,
                onConfirm: () => {
                    if (itemsUsingCategory.length > 0) {
                        showNotification(`‡§á‡§∏ ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§Æ‡•á‡§Ç ${itemsUsingCategory.length} ‡§Ü‡§á‡§ü‡§Æ ‡§π‡•à‡§Ç‡•§ ‡§™‡§π‡§≤‡•á ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§`, 'error');
                        return;
                    }
                    
                    categories = categories.filter(cat => cat !== categoryName);
                    localStorage.setItem('stockCategories', JSON.stringify(categories));
                    
                    showNotification(`${categoryName} ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡•Ä ‡§ó‡§à`, 'success');
                    renderModalCategories();
                }
            });
        }

        function renderModalCategories() {
            const categoryList = document.getElementById('modal-category-list');
            
            if (categories.length === 0) {
                categoryList.innerHTML = `
                    <div class="text-center py-8">
                        <div class="mb-3">
                            <span class="text-4xl">üìÇ</span>
                        </div>
                        <p class="text-gray-500 text-sm">‡§ï‡•ã‡§à ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à</p>
                        <p class="text-gray-400 text-xs mt-1">‡§ä‡§™‡§∞ ‡§∏‡•á ‡§®‡§à ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</p>
                    </div>
                `;
                return;
            }
            
            categoryList.innerHTML = categories.map((category, index) => `
                <div class="flex items-center justify-between bg-gradient-to-r from-gray-50 to-slate-50 hover:from-blue-50 hover:to-indigo-50 rounded-xl px-4 py-3 transition-all duration-200 transform hover:scale-102 hover:shadow-md group">
                    <div class="flex items-center gap-3">
                        <span class="text-lg">üìÅ</span>
                        <span class="text-sm font-medium text-gray-700">${category}</span>
                    </div>
                    <button onclick="deleteCategory('${category}')" class="text-red-400 hover:text-red-600 hover:bg-red-50 rounded-lg p-2 transition-all transform hover:scale-110 opacity-70 group-hover:opacity-100">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                    </button>
                </div>
            `).join('');
        }

        // Setup category input functionality
        function setupCategoryInput() {
            const input = document.getElementById('item-category');
            const dropdown = document.getElementById('category-dropdown');
            const arrow = document.getElementById('dropdown-arrow');
            const newCategoryInput = document.getElementById('new-category-name');
            
            // Enter key functionality for add category
            newCategoryInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addNewCategory();
                }
            });
            
            // Escape key to cancel add category
            newCategoryInput.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    cancelAddCategory();
                }
            });
            
            // Hide dropdown when clicking outside
            document.addEventListener('click', function(e) {
                const categoryContainer = input.closest('.relative');
                if (!categoryContainer.contains(e.target)) {
                    dropdown.classList.add('hidden');
                    arrow.style.transform = 'rotate(0deg)';
                    cancelAddCategory();
                    selectedCategoryIndex = -1;
                }
            });
        }

        // Tab switching
        function showTab(tabName) {
            console.log('Switching to tab:', tabName);
            
            // Hide all tab contents
            const allTabs = document.querySelectorAll('.tab-content');
            allTabs.forEach(tab => {
                tab.classList.add('hidden');
                console.log('Hiding tab:', tab.id);
            });
            
            // Reset all tab buttons
            const allTabButtons = document.querySelectorAll('.tab-button');
            allTabButtons.forEach(button => {
                button.classList.remove('text-blue-600', 'border-blue-600', 'border-b-2');
                button.classList.add('text-gray-500');
            });

            // Show selected tab content
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.remove('hidden');
                console.log('Showing tab:', tabName);
            } else {
                console.error('Tab not found:', tabName);
            }
            
            // Activate selected tab button
            const selectedButton = document.getElementById(tabName + '-tab');
            if (selectedButton) {
                selectedButton.classList.remove('text-gray-500');
                selectedButton.classList.add('text-blue-600', 'border-blue-600', 'border-b-2');
                console.log('Activated button:', tabName + '-tab');
            } else {
                console.error('Tab button not found:', tabName + '-tab');
            }
            
            // Special handling for specific tabs
            if (tabName === 'lowstock') {
                renderLowStockTab();
            }
        }

        // Notification system
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const icon = document.getElementById('notification-icon');
            const messageEl = document.getElementById('notification-message');
            const borderColor = type === 'success' ? 'border-green-500' : type === 'error' ? 'border-red-500' : 'border-blue-500';
            const iconBg = type === 'success' ? 'bg-green-100' : type === 'error' ? 'bg-red-100' : 'bg-blue-100';
            
            icon.textContent = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
            messageEl.textContent = message;
            
            // Update icon background color
            icon.parentElement.className = `flex-shrink-0 ${iconBg} rounded-full p-2`;
            notification.querySelector('div').className = `bg-white ${borderColor} rounded-xl shadow-2xl p-5 max-w-sm backdrop-blur-sm`;
            
            // Show with animation
            notification.classList.remove('hidden');
            notification.style.transform = 'translateX(100%) scale(0.8)';
            notification.style.opacity = '0';
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0) scale(1)';
                notification.style.opacity = '1';
            }, 10);
            
            setTimeout(() => hideNotification(), 4000);
        }

        function hideNotification() {
            const notification = document.getElementById('notification');
            notification.style.transform = 'translateX(100%) scale(0.8)';
            notification.style.opacity = '0';
            
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 300);
        }

        // Delete confirmation modal
        let deleteConfirmCallback = null;

        function showDeleteConfirmation(options) {
            const modal = document.getElementById('delete-modal');
            const modalContent = document.getElementById('delete-modal-content');
            const title = document.getElementById('delete-title');
            const itemName = document.getElementById('delete-item-name');
            const icon = document.getElementById('delete-icon');
            const message = document.getElementById('delete-message');
            const warning = document.getElementById('delete-warning');
            const warningText = document.getElementById('delete-warning-text');
            const confirmBtn = document.getElementById('delete-confirm-btn');
            
            // Set content
            title.textContent = options.title || 'Delete Confirmation';
            itemName.textContent = options.itemName || '';
            icon.textContent = options.icon || 'üóëÔ∏è';
            message.textContent = options.message || 'Are you sure you want to delete this item?';
            
            // Show/hide warning
            if (options.warning) {
                warning.classList.remove('hidden');
                warningText.textContent = options.warning;
            } else {
                warning.classList.add('hidden');
            }
            
            // Store callback
            deleteConfirmCallback = options.onConfirm;
            
            // Show modal with animation
            modal.classList.remove('hidden');
            
            setTimeout(() => {
                modalContent.style.transform = 'scale(1)';
                modalContent.style.opacity = '1';
            }, 10);
            
            // Add shake animation to confirm button
            confirmBtn.addEventListener('mouseenter', function() {
                this.style.animation = 'shake 0.5s ease-in-out';
            });
            
            confirmBtn.addEventListener('animationend', function() {
                this.style.animation = '';
            });
        }

        function hideDeleteConfirmation() {
            const modal = document.getElementById('delete-modal');
            const modalContent = document.getElementById('delete-modal-content');
            
            // Animate modal disappearance
            modalContent.style.transform = 'scale(0.95)';
            modalContent.style.opacity = '0';
            
            setTimeout(() => {
                modal.classList.add('hidden');
                deleteConfirmCallback = null;
            }, 300);
        }

        function confirmDelete() {
            if (deleteConfirmCallback) {
                deleteConfirmCallback();
                hideDeleteConfirmation();
            }
        }

        // Add enhanced animation CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
                20%, 40%, 60%, 80% { transform: translateX(2px); }
            }
            @keyframes pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.7; }
            }
            @keyframes glow {
                0%, 100% { box-shadow: 0 0 5px rgba(239, 68, 68, 0.5); }
                50% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.8); }
            }
            .animate-pulse {
                animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
            .animate-glow {
                animation: glow 2s ease-in-out infinite;
            }
        `;
        document.head.appendChild(style);

        // Update time
        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = now.toLocaleTimeString();
        }

        // Add new item
        function addItem() {
            console.log('Add item function called'); // Debug log
            
            const name = document.getElementById('item-name').value.trim();
            const category = document.getElementById('item-category').value.trim();
            const quantity = parseInt(document.getElementById('item-quantity').value) || 0;
            const minStock = parseInt(document.getElementById('item-min-stock').value) || 0;
            const price = parseFloat(document.getElementById('item-price').value) || 0;

            console.log('Form values:', { name, category, quantity, minStock, price }); // Debug log

            if (!name || !category) {
                showNotification('‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ü‡§á‡§ü‡§Æ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç', 'error');
                return;
            }

            // Check for duplicate names
            if (items.some(item => item.name.toLowerCase() === name.toLowerCase())) {
                showNotification('‡§Ø‡§π ‡§Ü‡§á‡§ü‡§Æ ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•à', 'error');
                return;
            }

            // Add category to list if it's new
            if (!categories.includes(category)) {
                categories.push(category);
                localStorage.setItem('stockCategories', JSON.stringify(categories));
                showNotification(`‡§®‡§à ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä "${category}" ‡§ú‡•ã‡§°‡§º‡•Ä ‡§ó‡§à`, 'info');
            }

            const newItem = {
                id: Date.now(),
                name,
                category,
                quantity,
                minStock,
                price,
                createdAt: new Date().toISOString()
            };

            console.log('New item created:', newItem); // Debug log

            // Add item to inventory
            items.push(newItem);
            localStorage.setItem('stockItems', JSON.stringify(items));

            // Only create transaction entry if there's opening stock
            if (quantity > 0) {
                const transaction = {
                    id: Date.now() + 1, // Ensure unique ID
                    itemId: newItem.id,
                    itemName: name,
                    type: 'in',
                    quantity,
                    notes: 'Opening Stock',
                    date: new Date().toISOString()
                };
                transactions.push(transaction);
                localStorage.setItem('stockTransactions', JSON.stringify(transactions));
                showNotification(`${name} ‡§Ü‡§á‡§ü‡§Æ ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ ‡§î‡§∞ Opening Stock ‡§ï‡§æ ‡§ü‡•ç‡§∞‡§æ‡§Ç‡§ú‡•à‡§ï‡•ç‡§∂‡§® ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ`, 'success');
            } else {
                showNotification(`${name} ‡§Ü‡§á‡§ü‡§Æ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ`, 'success');
            }

            // Clear form
            document.getElementById('item-name').value = '';
            document.getElementById('item-category').value = '';
            document.getElementById('item-quantity').value = '';
            document.getElementById('item-min-stock').value = '';
            document.getElementById('item-price').value = '';

            // Stay on Items tab and refresh data
            init();
        }

        // Global variable to track editing transaction
        let editingTransactionId = null;
        let originalTransactionData = null;

        // Record transaction
        function recordTransaction() {
            const itemId = document.getElementById('transaction-item-id').value;
            const type = document.getElementById('transaction-type').value;
            const quantity = parseInt(document.getElementById('transaction-quantity').value);
            const notes = document.getElementById('transaction-notes').value.trim();

            if (!itemId || !type || !quantity || quantity <= 0) {
                showNotification('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§´‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç', 'error');
                return;
            }

            const item = items.find(i => i.id == itemId);
            if (!item) {
                showNotification('‡§Ü‡§á‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ', 'error');
                return;
            }

            // Check if stock out is possible
            if (type === 'out' && quantity > item.quantity) {
                showNotification(`‡§∏‡•ç‡§ü‡•â‡§ï ‡§ï‡§Æ ‡§π‡•à! ‡§â‡§™‡§≤‡§¨‡•ç‡§ß: ${item.quantity}`, 'error');
                return;
            }

            // Update item quantity
            if (type === 'in') {
                item.quantity += quantity;
            } else {
                item.quantity -= quantity;
            }

            // Record transaction
            const transaction = {
                id: Date.now(),
                itemId: item.id,
                itemName: item.name,
                type,
                quantity,
                notes: notes || '',
                date: new Date().toISOString()
            };

            transactions.push(transaction);
            localStorage.setItem('stockItems', JSON.stringify(items));
            localStorage.setItem('stockTransactions', JSON.stringify(transactions));

            // Clear form
            clearTransactionForm();
            showNotification('‡§ü‡•ç‡§∞‡§æ‡§Ç‡§ú‡•à‡§ï‡•ç‡§∂‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ', 'success');
            init();
        }

        // Edit transaction
        function editTransaction(transactionId) {
            const transaction = transactions.find(t => t.id === transactionId);
            if (!transaction) {
                showNotification('‡§ü‡•ç‡§∞‡§æ‡§Ç‡§ú‡•à‡§ï‡•ç‡§∂‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ', 'error');
                return;
            }

            // Store original data for reverting stock changes
            editingTransactionId = transactionId;
            originalTransactionData = { ...transaction };

            // Revert the stock changes from original transaction
            const item = items.find(i => i.id == transaction.itemId);
            if (item) {
                if (transaction.type === 'in') {
                    item.quantity -= transaction.quantity;
                } else {
                    item.quantity += transaction.quantity;
                }
            }

            // Fill form with transaction data
            document.getElementById('transaction-item').value = transaction.itemName;
            document.getElementById('transaction-item-id').value = transaction.itemId;
            document.getElementById('transaction-type').value = transaction.type;
            document.getElementById('transaction-quantity').value = transaction.quantity;
            document.getElementById('transaction-notes').value = transaction.notes;

            // Show edit mode UI
            document.getElementById('transaction-form-title').textContent = 'Edit Transaction';
            document.getElementById('save-transaction-btn').classList.add('hidden');
            document.getElementById('update-transaction-btn').classList.remove('hidden');
            document.getElementById('cancel-edit-btn').classList.remove('hidden');

            showNotification('‡§ü‡•ç‡§∞‡§æ‡§Ç‡§ú‡•à‡§ï‡•ç‡§∂‡§® ‡§è‡§°‡§ø‡§ü ‡§Æ‡•ã‡§° ‡§Æ‡•á‡§Ç ‡§π‡•à', 'info');
        }

        // Update transaction
        function updateTransaction() {
            if (!editingTransactionId) return;

            const itemId = document.getElementById('transaction-item-id').value;
            const type = document.getElementById('transaction-type').value;
            const quantity = parseInt(document.getElementById('transaction-quantity').value);
            const notes = document.getElementById('transaction-notes').value.trim();

            if (!itemId || !type || !quantity || quantity <= 0) {
                showNotification('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§´‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç', 'error');
                return;
            }

            const item = items.find(i => i.id == itemId);
            if (!item) {
                showNotification('‡§Ü‡§á‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ', 'error');
                return;
            }

            // Check if stock out is possible with new quantity
            if (type === 'out' && quantity > item.quantity) {
                showNotification(`‡§∏‡•ç‡§ü‡•â‡§ï ‡§ï‡§Æ ‡§π‡•à! ‡§â‡§™‡§≤‡§¨‡•ç‡§ß: ${item.quantity}`, 'error');
                return;
            }

            // Apply new stock changes
            if (type === 'in') {
                item.quantity += quantity;
            } else {
                item.quantity -= quantity;
            }

            // Update transaction
            const transactionIndex = transactions.findIndex(t => t.id === editingTransactionId);
            if (transactionIndex !== -1) {
                transactions[transactionIndex] = {
                    ...transactions[transactionIndex],
                    itemId: item.id,
                    itemName: item.name,
                    type,
                    quantity,
                    notes: notes || ''
                };
            }

            localStorage.setItem('stockItems', JSON.stringify(items));
            localStorage.setItem('stockTransactions', JSON.stringify(transactions));

            cancelTransactionEdit();
            showNotification('‡§ü‡•ç‡§∞‡§æ‡§Ç‡§ú‡•à‡§ï‡•ç‡§∂‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ', 'success');
            init();
        }

        // Cancel transaction edit
        function cancelTransactionEdit() {
            if (editingTransactionId && originalTransactionData) {
                // Restore original stock changes
                const item = items.find(i => i.id == originalTransactionData.itemId);
                if (item) {
                    if (originalTransactionData.type === 'in') {
                        item.quantity += originalTransactionData.quantity;
                    } else {
                        item.quantity -= originalTransactionData.quantity;
                    }
                }
                localStorage.setItem('stockItems', JSON.stringify(items));
            }

            // Reset edit mode
            editingTransactionId = null;
            originalTransactionData = null;

            // Reset UI
            document.getElementById('transaction-form-title').textContent = 'Record Transaction';
            document.getElementById('save-transaction-btn').classList.remove('hidden');
            document.getElementById('update-transaction-btn').classList.add('hidden');
            document.getElementById('cancel-edit-btn').classList.add('hidden');

            clearTransactionForm();
            init();
        }

        // Delete transaction
        function deleteTransaction(transactionId) {
            const transaction = transactions.find(t => t.id === transactionId);
            if (!transaction) {
                showNotification('‡§ü‡•ç‡§∞‡§æ‡§Ç‡§ú‡•à‡§ï‡•ç‡§∂‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ', 'error');
                return;
            }

            showDeleteConfirmation({
                title: 'Delete Transaction',
                itemName: `${transaction.itemName} - ${transaction.type === 'in' ? 'Stock In' : 'Stock Out'} (${transaction.quantity})`,
                icon: 'üí∞',
                message: `‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§á‡§∏ ‡§ü‡•ç‡§∞‡§æ‡§Ç‡§ú‡•à‡§ï‡•ç‡§∂‡§® ‡§ï‡•ã ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?`,
                warning: '‡§ü‡•ç‡§∞‡§æ‡§Ç‡§ú‡•à‡§ï‡•ç‡§∂‡§® ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡§®‡•á ‡§∏‡•á ‡§∏‡•ç‡§ü‡•â‡§ï ‡§ï‡•Ä ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ ‡§≠‡•Ä ‡§¨‡§¶‡§≤ ‡§ú‡§æ‡§è‡§ó‡•Ä‡•§',
                onConfirm: () => {
                    // Revert stock changes
                    const item = items.find(i => i.id == transaction.itemId);
                    if (item) {
                        if (transaction.type === 'in') {
                            item.quantity -= transaction.quantity;
                        } else {
                            item.quantity += transaction.quantity;
                        }
                    }

                    // Remove transaction
                    transactions = transactions.filter(t => t.id !== transactionId);

                    localStorage.setItem('stockItems', JSON.stringify(items));
                    localStorage.setItem('stockTransactions', JSON.stringify(transactions));

                    showNotification('‡§ü‡•ç‡§∞‡§æ‡§Ç‡§ú‡•à‡§ï‡•ç‡§∂‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ', 'success');
                    init();
                }
            });
        }

        // Clear transaction form
        function clearTransactionForm() {
            document.getElementById('transaction-item').value = '';
            document.getElementById('transaction-item-id').value = '';
            document.getElementById('transaction-type').value = '';
            document.getElementById('transaction-quantity').value = '';
            document.getElementById('transaction-notes').value = '';
        }

        // Update dashboard
        function updateDashboard() {
            // Basic stats
            document.getElementById('total-items').textContent = items.length;
            
            // Low stock items
            const lowStockItems = items.filter(item => item.quantity <= item.minStock);
            document.getElementById('low-stock').textContent = lowStockItems.length;
            document.getElementById('low-stock-badge').textContent = lowStockItems.length;
            
            // Only count manually recorded transactions (exclude opening stock)
            const manualTransactions = transactions.filter(t => t.notes !== 'Opening Stock');
            document.getElementById('total-transactions').textContent = manualTransactions.length;

            // Calculate total inventory value
            const totalValue = items.reduce((sum, item) => sum + (item.quantity * item.price), 0);
            document.getElementById('total-value').textContent = `‚Çπ${totalValue.toLocaleString('en-IN')}`;

            // Count unique categories
            const uniqueCategories = [...new Set(items.map(item => item.category))];
            document.getElementById('total-categories').textContent = uniqueCategories.length;

            // Count items in stock (quantity > 0)
            const inStockItems = items.filter(item => item.quantity > 0);
            document.getElementById('in-stock-items').textContent = inStockItems.length;

            // Today's transactions
            const today = new Date().toDateString();
            const todayTransactions = manualTransactions.filter(t => new Date(t.date).toDateString() === today);
            document.getElementById('today-transactions').textContent = todayTransactions.length;

            // Update low stock items display
            updateLowStockDisplay(lowStockItems);

            // Recent transactions - only show manually recorded ones
            const recentTransactions = manualTransactions.slice(-5).reverse();
            updateRecentTransactions(recentTransactions);

            // Update category overview
            updateCategoryOverview(uniqueCategories);
        }

        // Update low stock items display
        function updateLowStockDisplay(lowStockItems) {
            const container = document.getElementById('low-stock-items');
            
            if (lowStockItems.length === 0) {
                container.innerHTML = '<p class="text-red-600 text-sm text-center py-4">‡§∏‡§≠‡•Ä ‡§Ü‡§á‡§ü‡§Æ‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§™‡§∞‡•ç‡§Ø‡§æ‡§™‡•ç‡§§ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§π‡•à ‚úÖ</p>';
            } else {
                container.innerHTML = lowStockItems.map(item => `
                    <div class="flex items-center justify-between bg-red-50 border border-red-200 rounded-lg p-3 hover:bg-red-100 transition-colors">
                        <div class="flex items-center gap-3">
                            <span class="text-red-500 text-lg">‚ö†Ô∏è</span>
                            <div>
                                <p class="font-medium text-red-800">${item.name}</p>
                                <p class="text-xs text-red-600">${item.category}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-red-700">${item.quantity}</p>
                            <p class="text-xs text-red-500">Min: ${item.minStock}</p>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Update recent transactions display
        function updateRecentTransactions(recentTransactions) {
            const container = document.getElementById('recent-transactions');
            document.getElementById('recent-count').textContent = recentTransactions.length;
            
            if (recentTransactions.length === 0) {
                container.innerHTML = '<p class="text-blue-600 text-sm text-center py-4">‡§ï‡•ã‡§à ‡§π‡§æ‡§≤ ‡§ï‡•Ä ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§®‡§π‡•Ä‡§Ç</p>';
            } else {
                container.innerHTML = recentTransactions.map(t => `
                    <div class="flex items-center justify-between bg-blue-50 border border-blue-200 rounded-lg p-3 hover:bg-blue-100 transition-colors">
                        <div class="flex items-center gap-3">
                            <span class="text-lg">${t.type === 'in' ? 'üìà' : 'üìâ'}</span>
                            <div>
                                <p class="font-medium text-blue-800">${t.itemName}</p>
                                <p class="text-xs text-blue-600">${new Date(t.date).toLocaleDateString('en-IN')}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="px-2 py-1 rounded-full text-xs font-medium ${t.type === 'in' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                                ${t.type === 'in' ? '+' : '-'}${t.quantity}
                            </span>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Update category overview
        function updateCategoryOverview(uniqueCategories) {
            const container = document.getElementById('category-overview');
            
            if (uniqueCategories.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500 col-span-full">
                        <span class="text-4xl mb-2 block">üì¶</span>
                        <p>‡§ï‡•ã‡§à ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä</p>
                        <p class="text-sm text-gray-400 mt-1">‡§Ü‡§á‡§ü‡§Æ ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ä‡§™‡§∞ ‡§¨‡§ü‡§® ‡§¶‡§¨‡§æ‡§è‡§Ç</p>
                    </div>
                `;
            } else {
                container.innerHTML = uniqueCategories.map(category => {
                    const categoryItems = items.filter(item => item.category === category);
                    const totalItems = categoryItems.length;
                    const totalStock = categoryItems.reduce((sum, item) => sum + item.quantity, 0);
                    const totalValue = categoryItems.reduce((sum, item) => sum + (item.quantity * item.price), 0);
                    const lowStockCount = categoryItems.filter(item => item.quantity <= item.minStock).length;
                    
                    return `
                        <div class="bg-gradient-to-br from-gray-50 to-slate-100 rounded-xl p-4 border border-gray-200 hover:shadow-md transition-all transform hover:scale-102">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-2">
                                    <span class="text-lg">üìÅ</span>
                                    <h4 class="font-semibold text-gray-800">${category}</h4>
                                </div>
                                ${lowStockCount > 0 ? `<span class="bg-red-100 text-red-600 px-2 py-1 rounded-full text-xs font-medium">‚ö†Ô∏è ${lowStockCount}</span>` : ''}
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Items:</span>
                                    <span class="font-medium">${totalItems}</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Total Stock:</span>
                                    <span class="font-medium">${totalStock}</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Value:</span>
                                    <span class="font-medium text-green-600">‚Çπ${totalValue.toLocaleString('en-IN')}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // Search functionality
        function setupSearch() {
            document.getElementById('search-items').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                renderItems(searchTerm);
            });
        }

        // Export data
        function exportData(type) {
            let data, filename;
            
            if (type === 'items') {
                data = items.map(item => ({
                    'Item Name': item.name,
                    'Category': item.category,
                    'Current Stock': item.quantity,
                    'Min Stock': item.minStock,
                    'Unit Price': item.price,
                    'Total Value': (item.quantity * item.price).toFixed(2)
                }));
                filename = 'inventory_items.csv';
            } else {
                data = transactions.map(t => ({
                    'Date': new Date(t.date).toLocaleDateString(),
                    'Item': t.itemName,
                    'Type': t.type === 'in' ? 'Stock In' : 'Stock Out',
                    'Quantity': t.quantity,
                    'Notes': t.notes
                }));
                filename = 'transactions.csv';
            }

            const csv = convertToCSV(data);
            downloadCSV(csv, filename);
            showNotification('‡§°‡•á‡§ü‡§æ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ', 'success');
        }

        function convertToCSV(data) {
            if (data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const csvContent = [
                headers.join(','),
                ...data.map(row => headers.map(header => `"${row[header]}"`).join(','))
            ].join('\n');
            
            return csvContent;
        }

        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('hidden', '');
            a.setAttribute('href', url);
            a.setAttribute('download', filename);
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Render items table
        function renderItems(searchTerm = '') {
            const tbody = document.getElementById('items-table');
            
            let filteredItems = items;
            if (searchTerm) {
                filteredItems = items.filter(item => 
                    item.name.toLowerCase().includes(searchTerm) ||
                    item.category.toLowerCase().includes(searchTerm)
                );
            }
            
            if (filteredItems.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center py-8 text-gray-500">‡§ï‡•ã‡§à ‡§Ü‡§á‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</td></tr>';
                return;
            }

            tbody.innerHTML = filteredItems.map(item => {
                const isLowStock = item.quantity <= item.minStock;
                const totalValue = (item.quantity * item.price).toFixed(2);
                return `
                    <tr class="border-b border-gray-100 hover:bg-gray-50">
                        <td class="py-3 px-4 font-medium">${item.name}</td>
                        <td class="py-3 px-4">${item.category}</td>
                        <td class="py-3 px-4 font-medium ${isLowStock ? 'text-red-600' : ''}">${item.quantity}</td>
                        <td class="py-3 px-4">‚Çπ${item.price.toFixed(2)}</td>
                        <td class="py-3 px-4 font-medium">‚Çπ${totalValue}</td>
                        <td class="py-3 px-4">
                            <span class="px-2 py-1 rounded text-sm ${isLowStock ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                                ${isLowStock ? '‚ö†Ô∏è Low Stock' : '‚úÖ In Stock'}
                            </span>
                        </td>
                        <td class="py-3 px-4">
                            <div class="flex gap-2">
                                <button onclick="editItem(${item.id})" class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-1 rounded-lg text-sm font-medium transition-all transform hover:scale-105">
                                    ‚úèÔ∏è Edit
                                </button>
                                <button onclick="deleteItem(${item.id})" class="bg-red-100 hover:bg-red-200 text-red-700 px-3 py-1 rounded-lg text-sm font-medium transition-all transform hover:scale-105">
                                    üóëÔ∏è Delete
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Global variable to track editing item
        let editingItemId = null;

        // Edit item
        function editItem(itemId) {
            const item = items.find(i => i.id === itemId);
            if (!item) {
                showNotification('‡§Ü‡§á‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ', 'error');
                return;
            }

            // Store editing item ID
            editingItemId = itemId;

            // Fill form with item data
            document.getElementById('item-name').value = item.name;
            document.getElementById('item-category').value = item.category;
            document.getElementById('item-quantity').value = item.quantity;
            document.getElementById('item-min-stock').value = item.minStock;
            document.getElementById('item-price').value = item.price;

            // Change form title and button
            document.querySelector('.bg-white.rounded-xl.shadow-lg.p-6.mb-6 h3').textContent = 'Edit Item';
            
            // Hide add button and show update/cancel buttons
            const addButton = document.querySelector('button[onclick="addItem()"]');
            addButton.style.display = 'none';
            
            // Create update and cancel buttons if they don't exist
            let updateButton = document.getElementById('update-item-btn');
            let cancelButton = document.getElementById('cancel-edit-item-btn');
            
            if (!updateButton) {
                updateButton = document.createElement('button');
                updateButton.id = 'update-item-btn';
                updateButton.className = 'mt-4 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors mr-3';
                updateButton.textContent = '‚úÖ Update Item';
                updateButton.onclick = updateItem;
                addButton.parentNode.appendChild(updateButton);
            }
            
            if (!cancelButton) {
                cancelButton = document.createElement('button');
                cancelButton.id = 'cancel-edit-item-btn';
                cancelButton.className = 'mt-4 bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg font-medium transition-colors';
                cancelButton.textContent = '‚ùå Cancel Edit';
                cancelButton.onclick = cancelItemEdit;
                addButton.parentNode.appendChild(cancelButton);
            }
            
            updateButton.style.display = 'inline-block';
            cancelButton.style.display = 'inline-block';

            showNotification('‡§Ü‡§á‡§ü‡§Æ ‡§è‡§°‡§ø‡§ü ‡§Æ‡•ã‡§° ‡§Æ‡•á‡§Ç ‡§π‡•à', 'info');
            
            // Scroll to form
            document.querySelector('.bg-white.rounded-xl.shadow-lg.p-6.mb-6').scrollIntoView({ behavior: 'smooth' });
        }

        // Update item
        function updateItem() {
            if (!editingItemId) return;

            const name = document.getElementById('item-name').value.trim();
            const category = document.getElementById('item-category').value.trim();
            const quantity = parseInt(document.getElementById('item-quantity').value) || 0;
            const minStock = parseInt(document.getElementById('item-min-stock').value) || 0;
            const price = parseFloat(document.getElementById('item-price').value) || 0;

            if (!name || !category) {
                showNotification('‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ü‡§á‡§ü‡§Æ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç', 'error');
                return;
            }

            // Check for duplicate names (excluding current item)
            if (items.some(item => item.id !== editingItemId && item.name.toLowerCase() === name.toLowerCase())) {
                showNotification('‡§Ø‡§π ‡§Ü‡§á‡§ü‡§Æ ‡§®‡§æ‡§Æ ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•à', 'error');
                return;
            }

            // Find and update item
            const itemIndex = items.findIndex(i => i.id === editingItemId);
            if (itemIndex === -1) {
                showNotification('‡§Ü‡§á‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ', 'error');
                return;
            }

            const oldItem = { ...items[itemIndex] };
            const quantityDifference = quantity - oldItem.quantity;

            // Update item
            items[itemIndex] = {
                ...items[itemIndex],
                name,
                category,
                quantity,
                minStock,
                price
            };

            // Add category to list if it's new
            if (!categories.includes(category)) {
                categories.push(category);
                localStorage.setItem('stockCategories', JSON.stringify(categories));
                showNotification(`‡§®‡§à ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä "${category}" ‡§ú‡•ã‡§°‡§º‡•Ä ‡§ó‡§à`, 'info');
            }

            // Update related transactions if item name changed
            if (oldItem.name !== name) {
                transactions.forEach(t => {
                    if (t.itemId === editingItemId) {
                        t.itemName = name;
                    }
                });
            }

            // Record stock adjustment transaction if quantity changed
            if (quantityDifference !== 0) {
                const adjustmentTransaction = {
                    id: Date.now(),
                    itemId: editingItemId,
                    itemName: name,
                    type: quantityDifference > 0 ? 'in' : 'out',
                    quantity: Math.abs(quantityDifference),
                    notes: `Stock Adjustment (Edit: ${oldItem.quantity} ‚Üí ${quantity})`,
                    date: new Date().toISOString()
                };
                transactions.push(adjustmentTransaction);
            }

            localStorage.setItem('stockItems', JSON.stringify(items));
            localStorage.setItem('stockTransactions', JSON.stringify(transactions));

            cancelItemEdit();
            showNotification(`${name} ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ`, 'success');
            init();
        }

        // Cancel item edit
        function cancelItemEdit() {
            editingItemId = null;

            // Clear form
            document.getElementById('item-name').value = '';
            document.getElementById('item-category').value = '';
            document.getElementById('item-quantity').value = '';
            document.getElementById('item-min-stock').value = '';
            document.getElementById('item-price').value = '';

            // Reset form title
            document.querySelector('.bg-white.rounded-xl.shadow-lg.p-6.mb-6 h3').textContent = 'Add New Item';

            // Show add button and hide update/cancel buttons
            const addButton = document.querySelector('button[onclick="addItem()"]');
            const updateButton = document.getElementById('update-item-btn');
            const cancelButton = document.getElementById('cancel-edit-item-btn');

            addButton.style.display = 'inline-block';
            if (updateButton) updateButton.style.display = 'none';
            if (cancelButton) cancelButton.style.display = 'none';
        }

        // Delete item
        function deleteItem(itemId) {
            const item = items.find(i => i.id === itemId);
            if (!item) {
                showNotification('‡§Ü‡§á‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ', 'error');
                return;
            }

            // Check if item has transactions
            const relatedTransactions = transactions.filter(t => t.itemId === itemId);
            
            showDeleteConfirmation({
                title: 'Delete Item',
                itemName: item.name,
                icon: 'üì¶',
                message: `‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à "${item.name}" ‡§ï‡•ã ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?`,
                warning: relatedTransactions.length > 0 ? `‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä: ‡§á‡§∏ ‡§Ü‡§á‡§ü‡§Æ ‡§ï‡•á ${relatedTransactions.length} ‡§ü‡•ç‡§∞‡§æ‡§Ç‡§ú‡•à‡§ï‡•ç‡§∂‡§® ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§á‡§ü‡§Æ ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡§®‡•á ‡§∏‡•á ‡§∏‡§≠‡•Ä ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§ü‡•ç‡§∞‡§æ‡§Ç‡§ú‡•à‡§ï‡•ç‡§∂‡§® ‡§≠‡•Ä ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§π‡•ã ‡§ú‡§æ‡§è‡§Ç‡§ó‡•á‡•§` : null,
                onConfirm: () => {
                    // Remove item and related transactions
                    items = items.filter(i => i.id !== itemId);
                    transactions = transactions.filter(t => t.itemId !== itemId);
                    
                    localStorage.setItem('stockItems', JSON.stringify(items));
                    localStorage.setItem('stockTransactions', JSON.stringify(transactions));
                    
                    showNotification(`${item.name} ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ`, 'success');
                    
                    // Cancel edit if deleting currently editing item
                    if (editingItemId === itemId) {
                        cancelItemEdit();
                    }
                    
                    init();
                }
            });
        }

        // Render transactions table
        function renderTransactions() {
            const tbody = document.getElementById('transactions-table');
            
            // Filter out opening stock transactions - only show manually recorded ones
            const manualTransactions = transactions.filter(t => t.notes !== 'Opening Stock');
            
            if (manualTransactions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-500">No transactions recorded yet</td></tr>';
                return;
            }

            tbody.innerHTML = manualTransactions.slice().reverse().map(t => `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-3 px-4">${new Date(t.date).toLocaleDateString()}</td>
                    <td class="py-3 px-4">${t.itemName}</td>
                    <td class="py-3 px-4">
                        <span class="px-2 py-1 rounded text-sm ${t.type === 'in' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${t.type === 'in' ? 'üìà Stock In' : 'üìâ Stock Out'}
                        </span>
                    </td>
                    <td class="py-3 px-4 font-medium">${t.quantity}</td>
                    <td class="py-3 px-4">${t.notes || '-'}</td>
                    <td class="py-3 px-4">
                        <div class="flex gap-2">
                            <button onclick="editTransaction(${t.id})" class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-1 rounded-lg text-sm font-medium transition-all transform hover:scale-105">
                                ‚úèÔ∏è Edit
                            </button>
                            <button onclick="deleteTransaction(${t.id})" class="bg-red-100 hover:bg-red-200 text-red-700 px-3 py-1 rounded-lg text-sm font-medium transition-all transform hover:scale-105">
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Low Stock Tab Functions
        function renderLowStockTab() {
            const lowStockItems = items.filter(item => item.quantity <= item.minStock);
            
            // Update count badge
            document.getElementById('lowstock-count').textContent = lowStockItems.length;
            
            // Update category filter
            updateLowStockCategoryFilter();
            
            // Update statistics
            updateLowStockStatistics(lowStockItems);
            
            // Render items grid
            renderLowStockGrid(lowStockItems);
        }

        function updateLowStockCategoryFilter() {
            const categoryFilter = document.getElementById('lowstock-category-filter');
            const uniqueCategories = [...new Set(items.map(item => item.category))];
            
            categoryFilter.innerHTML = '<option value="">All Categories</option>' + 
                uniqueCategories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
        }

        function updateLowStockStatistics(lowStockItems) {
            let criticalCount = 0, highCount = 0, mediumCount = 0, totalReorderValue = 0;
            
            lowStockItems.forEach(item => {
                const shortage = Math.max(0, item.minStock - item.quantity);
                totalReorderValue += shortage * item.price;
                
                if (item.quantity === 0) {
                    criticalCount++;
                } else if (item.quantity <= (item.minStock * 0.5)) {
                    highCount++;
                } else {
                    mediumCount++;
                }
            });
            
            document.getElementById('critical-count').textContent = criticalCount;
            document.getElementById('high-count').textContent = highCount;
            document.getElementById('medium-count').textContent = mediumCount;
            document.getElementById('reorder-value').textContent = `‚Çπ${totalReorderValue.toLocaleString('en-IN')}`;
        }

        function renderLowStockGrid(lowStockItems) {
            const container = document.getElementById('lowstock-grid');
            
            if (lowStockItems.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="mb-6">
                            <span class="text-8xl">‚úÖ</span>
                        </div>
                        <h4 class="text-2xl font-bold text-green-700 mb-3">‡§¨‡§π‡•Å‡§§ ‡§¨‡§¢‡§º‡§ø‡§Ø‡§æ!</h4>
                        <p class="text-lg text-green-600 mb-2">‡§∏‡§≠‡•Ä ‡§Ü‡§á‡§ü‡§Æ‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§™‡§∞‡•ç‡§Ø‡§æ‡§™‡•ç‡§§ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§π‡•à</p>
                        <p class="text-sm text-green-500">‡§ï‡•ã‡§à ‡§§‡§§‡•ç‡§ï‡§æ‡§≤ ‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = lowStockItems.map(item => {
                const urgencyLevel = item.quantity === 0 ? 'critical' : item.quantity <= (item.minStock * 0.5) ? 'high' : 'medium';
                const urgencyColors = {
                    critical: 'from-red-600 to-red-700 text-white',
                    high: 'from-orange-500 to-red-500 text-white', 
                    medium: 'from-yellow-400 to-orange-400 text-white'
                };
                const urgencyIcons = {
                    critical: 'üö®',
                    high: '‚ö†Ô∏è',
                    medium: '‚ö°'
                };
                const urgencyLabels = {
                    critical: 'Out of Stock',
                    high: 'Critical Low',
                    medium: 'Low Stock'
                };
                
                return `
                    <div class="bg-white rounded-xl border-2 border-red-200 hover:border-red-300 p-4 transition-all transform hover:scale-102 hover:shadow-lg">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">üì¶</span>
                                <h4 class="font-semibold text-gray-800 text-sm">${item.name}</h4>
                            </div>
                            <span class="bg-gradient-to-r ${urgencyColors[urgencyLevel]} px-2 py-1 rounded-full text-xs font-bold">
                                ${urgencyIcons[urgencyLevel]} ${urgencyLabels[urgencyLevel]}
                            </span>
                        </div>
                        
                        <div class="space-y-2 mb-4">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Category:</span>
                                <span class="font-medium text-gray-800">${item.category}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Current Stock:</span>
                                <span class="font-bold text-red-600">${item.quantity}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Min Required:</span>
                                <span class="font-medium text-gray-700">${item.minStock}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Shortage:</span>
                                <span class="font-bold text-red-700">${Math.max(0, item.minStock - item.quantity)}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Unit Price:</span>
                                <span class="font-medium text-green-600">‚Çπ${item.price.toFixed(2)}</span>
                            </div>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div class="mb-3">
                            <div class="flex justify-between text-xs text-gray-600 mb-1">
                                <span>Stock Level</span>
                                <span>${Math.round((item.quantity / Math.max(item.minStock, 1)) * 100)}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-gradient-to-r ${urgencyLevel === 'critical' ? 'from-red-500 to-red-600' : urgencyLevel === 'high' ? 'from-orange-400 to-red-500' : 'from-yellow-400 to-orange-400'} h-2 rounded-full transition-all duration-300" 
                                     style="width: ${Math.min(100, (item.quantity / Math.max(item.minStock, 1)) * 100)}%"></div>
                            </div>
                        </div>
                        
                        <!-- Quick Action Buttons -->
                        <div class="flex gap-2">
                            <button onclick="quickAddStock(${item.id}, '${item.name}')" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-3 py-2 rounded-lg text-xs font-semibold transition-all transform hover:scale-105">
                                ‚ûï Add Stock
                            </button>
                            <button onclick="viewItemHistory(${item.id})" class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-2 rounded-lg text-xs font-medium transition-all">
                                üìä History
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterLowStockItems() {
            const categoryFilter = document.getElementById('lowstock-category-filter').value;
            const urgencyFilter = document.getElementById('lowstock-urgency-filter').value;
            const searchTerm = document.getElementById('lowstock-search').value.toLowerCase();
            
            let filteredItems = items.filter(item => item.quantity <= item.minStock);
            
            // Apply category filter
            if (categoryFilter) {
                filteredItems = filteredItems.filter(item => item.category === categoryFilter);
            }
            
            // Apply urgency filter
            if (urgencyFilter) {
                filteredItems = filteredItems.filter(item => {
                    const urgencyLevel = item.quantity === 0 ? 'critical' : item.quantity <= (item.minStock * 0.5) ? 'high' : 'medium';
                    return urgencyLevel === urgencyFilter;
                });
            }
            
            // Apply search filter
            if (searchTerm) {
                filteredItems = filteredItems.filter(item => 
                    item.name.toLowerCase().includes(searchTerm) ||
                    item.category.toLowerCase().includes(searchTerm)
                );
            }
            
            renderLowStockGrid(filteredItems);
        }

        function refreshLowStock() {
            renderLowStockTab();
            showNotification('Low Stock ‡§°‡•á‡§ü‡§æ ‡§∞‡§ø‡§´‡•ç‡§∞‡•á‡§∂ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ', 'success');
        }

        function bulkAddStock() {
            const lowStockItems = items.filter(item => item.quantity <= item.minStock);
            
            if (lowStockItems.length === 0) {
                showNotification('‡§ï‡•ã‡§à Low Stock ‡§Ü‡§á‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ', 'info');
                return;
            }
            
            showBulkAddStockModal(lowStockItems);
        }

        // Show Bulk Add Stock Modal
        function showBulkAddStockModal(lowStockItems) {
            const modal = document.getElementById('bulk-add-stock-modal');
            if (!modal) {
                createBulkAddStockModal();
                return showBulkAddStockModal(lowStockItems);
            }
            
            // Store items reference
            window.currentBulkStockItems = lowStockItems;
            
            // Populate modal with items
            renderBulkStockItems(lowStockItems);
            
            // Show modal with animation
            modal.classList.remove('hidden');
            const modalContent = document.getElementById('bulk-add-stock-modal-content');
            
            setTimeout(() => {
                modalContent.style.transform = 'scale(1)';
                modalContent.style.opacity = '1';
            }, 10);
        }

        // Create Bulk Add Stock Modal
        function createBulkAddStockModal() {
            const modalHTML = `
                <!-- Bulk Add Stock Modal -->
                <div id="bulk-add-stock-modal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden flex items-center justify-center backdrop-blur-sm">
                    <div id="bulk-add-stock-modal-content" class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl mx-4 max-h-[90vh] overflow-hidden transform transition-all duration-300 scale-95 opacity-0">
                        <!-- Header -->
                        <div class="bg-gradient-to-r from-orange-500 to-red-600 rounded-t-2xl p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="bg-white bg-opacity-20 p-3 rounded-full">
                                        <span class="text-2xl">üì¶</span>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold">Bulk Add Stock</h3>
                                        <p class="text-orange-100 text-sm">Add stock to multiple low stock items</p>
                                    </div>
                                </div>
                                <button onclick="hideBulkAddStockModal()" class="text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition-all">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Content -->
                        <div class="flex-1 overflow-y-auto p-6">
                            <!-- Summary Card -->
                            <div class="bg-gradient-to-r from-orange-50 to-red-50 rounded-xl p-4 mb-6 border-2 border-orange-200">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-semibold text-orange-800 mb-2 flex items-center gap-2">
                                            <span>üìä</span>
                                            Bulk Stock Summary
                                        </h4>
                                        <div class="grid grid-cols-3 gap-4 text-sm">
                                            <div>
                                                <span class="text-orange-700">Items Selected:</span>
                                                <span class="font-bold text-orange-800 ml-2" id="bulk-selected-count">0</span>
                                            </div>
                                            <div>
                                                <span class="text-orange-700">Total Investment:</span>
                                                <span class="font-bold text-orange-800 ml-2" id="bulk-total-investment">‚Çπ0</span>
                                            </div>
                                            <div>
                                                <span class="text-orange-700">Total Quantity:</span>
                                                <span class="font-bold text-orange-800 ml-2" id="bulk-total-quantity">0</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="selectAllBulkItems()" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all">
                                            ‚úÖ Select All
                                        </button>
                                        <button onclick="clearAllBulkItems()" class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all">
                                            ‚ùå Clear All
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Items Grid -->
                            <div id="bulk-stock-items-container" class="space-y-3">
                                <!-- Items will be populated here -->
                            </div>
                        </div>
                        
                        <!-- Footer -->
                        <div class="bg-gray-50 rounded-b-2xl px-6 py-4 border-t">
                            <div class="flex gap-3 justify-between items-center">
                                <div class="text-sm text-gray-600">
                                    <span class="font-medium">üí° Tip:</span> 
                                    Use suggested quantities or customize as needed. Only selected items will be processed.
                                </div>
                                <div class="flex gap-3">
                                    <button onclick="hideBulkAddStockModal()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-3 px-6 rounded-xl transition-all transform hover:scale-105">
                                        <span class="mr-2">‚ùå</span>
                                        Cancel
                                    </button>
                                    <button onclick="confirmBulkAddStock()" class="bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white font-semibold py-3 px-8 rounded-xl transition-all transform hover:scale-105 shadow-lg">
                                        <span class="mr-2">üöÄ</span>
                                        Add Selected Stock
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        // Render Bulk Stock Items
        function renderBulkStockItems(lowStockItems) {
            const container = document.getElementById('bulk-stock-items-container');
            
            container.innerHTML = lowStockItems.map((item, index) => {
                const shortage = Math.max(0, item.minStock - item.quantity);
                const suggestedQty = shortage > 0 ? shortage + Math.ceil(item.minStock * 0.2) : Math.ceil(item.minStock * 0.5);
                const urgencyLevel = item.quantity === 0 ? 'critical' : item.quantity <= (item.minStock * 0.5) ? 'high' : 'medium';
                const urgencyColors = {
                    critical: 'border-red-500 bg-red-50',
                    high: 'border-orange-500 bg-orange-50', 
                    medium: 'border-yellow-500 bg-yellow-50'
                };
                const urgencyIcons = {
                    critical: 'üö®',
                    high: '‚ö†Ô∏è',
                    medium: '‚ö°'
                };
                
                return `
                    <div class="bulk-stock-item border-2 ${urgencyColors[urgencyLevel]} rounded-xl p-4 transition-all hover:shadow-md" data-item-id="${item.id}">
                        <div class="flex items-center gap-4">
                            <!-- Selection Checkbox -->
                            <div class="flex-shrink-0">
                                <label class="flex items-center cursor-pointer">
                                    <input type="checkbox" class="bulk-item-checkbox w-5 h-5 text-orange-600 rounded focus:ring-orange-500" 
                                           onchange="updateBulkSummary()" checked>
                                    <span class="ml-2 text-lg">${urgencyIcons[urgencyLevel]}</span>
                                </label>
                            </div>
                            
                            <!-- Item Info -->
                            <div class="flex-1 grid grid-cols-1 md:grid-cols-4 gap-4 items-center">
                                <div>
                                    <h4 class="font-semibold text-gray-800">${item.name}</h4>
                                    <p class="text-sm text-gray-600">${item.category}</p>
                                </div>
                                
                                <div class="text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Current:</span>
                                        <span class="font-bold text-red-600">${item.quantity}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Min:</span>
                                        <span class="font-medium">${item.minStock}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Shortage:</span>
                                        <span class="font-bold text-red-700">${shortage}</span>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Quantity to Add</label>
                                    <div class="flex items-center gap-2">
                                        <input type="number" class="bulk-quantity-input w-20 border border-gray-300 rounded-lg px-2 py-1 text-sm font-semibold focus:ring-2 focus:ring-orange-500 focus:border-orange-500" 
                                               value="${suggestedQty}" min="0" onchange="updateBulkSummary()" data-price="${item.price}">
                                        <button onclick="setBulkSuggested(this, ${suggestedQty})" class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-2 py-1 rounded text-xs transition-all" title="Use Suggested">
                                            üí°
                                        </button>
                                    </div>
                                    <div class="text-xs text-gray-500 mt-1">
                                        Suggested: ${suggestedQty}
                                    </div>
                                </div>
                                
                                <div class="text-right">
                                    <div class="text-sm">
                                        <div class="text-gray-600">Unit Price:</div>
                                        <div class="font-medium text-green-600">‚Çπ${item.price.toFixed(2)}</div>
                                    </div>
                                    <div class="text-sm mt-1">
                                        <div class="text-gray-600">Investment:</div>
                                        <div class="font-bold text-orange-600 bulk-item-investment">‚Çπ${(suggestedQty * item.price).toFixed(2)}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Initial summary update
            updateBulkSummary();
        }

        // Update Bulk Summary
        function updateBulkSummary() {
            let selectedCount = 0;
            let totalInvestment = 0;
            let totalQuantity = 0;
            
            document.querySelectorAll('.bulk-stock-item').forEach(itemEl => {
                const checkbox = itemEl.querySelector('.bulk-item-checkbox');
                const quantityInput = itemEl.querySelector('.bulk-quantity-input');
                const investmentEl = itemEl.querySelector('.bulk-item-investment');
                
                if (checkbox.checked) {
                    const quantity = parseInt(quantityInput.value) || 0;
                    const price = parseFloat(quantityInput.dataset.price) || 0;
                    const investment = quantity * price;
                    
                    selectedCount++;
                    totalQuantity += quantity;
                    totalInvestment += investment;
                    
                    investmentEl.textContent = `‚Çπ${investment.toFixed(2)}`;
                } else {
                    investmentEl.textContent = '‚Çπ0.00';
                }
            });
            
            document.getElementById('bulk-selected-count').textContent = selectedCount;
            document.getElementById('bulk-total-investment').textContent = `‚Çπ${totalInvestment.toLocaleString('en-IN')}`;
            document.getElementById('bulk-total-quantity').textContent = totalQuantity;
        }

        // Select All Bulk Items
        function selectAllBulkItems() {
            document.querySelectorAll('.bulk-item-checkbox').forEach(checkbox => {
                checkbox.checked = true;
            });
            updateBulkSummary();
        }

        // Clear All Bulk Items
        function clearAllBulkItems() {
            document.querySelectorAll('.bulk-item-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            updateBulkSummary();
        }

        // Set Bulk Suggested Quantity
        function setBulkSuggested(button, suggestedQty) {
            const quantityInput = button.previousElementSibling;
            quantityInput.value = suggestedQty;
            updateBulkSummary();
        }

        // Hide Bulk Add Stock Modal
        function hideBulkAddStockModal() {
            const modal = document.getElementById('bulk-add-stock-modal');
            const modalContent = document.getElementById('bulk-add-stock-modal-content');
            
            modalContent.style.transform = 'scale(0.95)';
            modalContent.style.opacity = '0';
            
            setTimeout(() => {
                modal.classList.add('hidden');
                window.currentBulkStockItems = null;
            }, 300);
        }

        // Confirm Bulk Add Stock
        function confirmBulkAddStock() {
            const itemsToProcess = [];
            
            document.querySelectorAll('.bulk-stock-item').forEach(itemEl => {
                const checkbox = itemEl.querySelector('.bulk-item-checkbox');
                const quantityInput = itemEl.querySelector('.bulk-quantity-input');
                const itemId = parseInt(itemEl.dataset.itemId);
                
                if (checkbox.checked) {
                    const quantity = parseInt(quantityInput.value) || 0;
                    if (quantity > 0) {
                        const item = items.find(i => i.id === itemId);
                        if (item) {
                            itemsToProcess.push({
                                item: item,
                                quantity: quantity
                            });
                        }
                    }
                }
            });
            
            if (itemsToProcess.length === 0) {
                showNotification('‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ ‡§è‡§ï ‡§Ü‡§á‡§ü‡§Æ ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç', 'error');
                return;
            }
            
            // Process bulk stock addition
            itemsToProcess.forEach(({ item, quantity }) => {
                item.quantity += quantity;
                
                const transaction = {
                    id: Date.now() + Math.random(),
                    itemId: item.id,
                    itemName: item.name,
                    type: 'in',
                    quantity: quantity,
                    notes: 'Bulk Stock Addition (Low Stock Alert)',
                    date: new Date().toISOString()
                };
                
                transactions.push(transaction);
            });
            
            localStorage.setItem('stockItems', JSON.stringify(items));
            localStorage.setItem('stockTransactions', JSON.stringify(transactions));
            
            hideBulkAddStockModal();
            showNotification(`${itemsToProcess.length} ‡§Ü‡§á‡§ü‡§Æ‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§∏‡•ç‡§ü‡•â‡§ï ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ`, 'success');
            init();
        }

        function printLowStockReport() {
            const lowStockItems = items.filter(item => item.quantity <= item.minStock);
            
            if (lowStockItems.length === 0) {
                showNotification('‡§ï‡•ã‡§à Low Stock ‡§Ü‡§á‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ', 'info');
                return;
            }
            
            // Create print window
            const printWindow = window.open('', '_blank');
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Low Stock Report</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 20px; 
                            color: #333;
                        }
                        .header { 
                            text-align: center; 
                            margin-bottom: 30px; 
                            border-bottom: 3px solid #DC2626;
                            padding-bottom: 20px;
                        }
                        .company-name { 
                            font-size: 28px; 
                            font-weight: bold; 
                            color: #DC2626;
                            margin-bottom: 5px;
                        }
                        .report-title { 
                            font-size: 20px; 
                            color: #374151;
                            margin-bottom: 10px;
                        }
                        .summary { 
                            display: flex; 
                            justify-content: space-around; 
                            margin-bottom: 20px; 
                            background: #FEF2F2;
                            padding: 15px;
                            border-radius: 8px;
                            border: 2px solid #FECACA;
                        }
                        .summary-item { 
                            text-align: center; 
                            padding: 10px;
                        }
                        .summary-value { 
                            font-size: 24px; 
                            font-weight: bold; 
                            color: #DC2626;
                        }
                        .summary-label { 
                            font-size: 12px; 
                            color: #6B7280; 
                            margin-top: 5px;
                        }
                        table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin-top: 20px;
                            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
                        }
                        th { 
                            background: #DC2626; 
                            color: white; 
                            padding: 12px 8px; 
                            text-align: left; 
                            font-weight: bold;
                        }
                        td { 
                            padding: 10px 8px; 
                            border-bottom: 1px solid #E5E7EB;
                        }
                        tr:nth-child(even) { 
                            background: #FEF2F2;
                        }
                        .critical { background: #FEE2E2 !important; color: #DC2626; font-weight: bold; }
                        .high { background: #FED7AA !important; color: #EA580C; font-weight: bold; }
                        .medium { background: #FEF3C7 !important; color: #D97706; font-weight: bold; }
                        .footer { 
                            margin-top: 30px; 
                            text-align: center; 
                            font-size: 12px; 
                            color: #6B7280;
                            border-top: 1px solid #E5E7EB;
                            padding-top: 15px;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="company-name">‚ö†Ô∏è Low Stock Alert Report</div>
                        <div class="report-title">Immediate Action Required</div>
                        <div style="font-size: 14px; color: #6B7280;">Generated on ${new Date().toLocaleString('en-IN')}</div>
                    </div>
                    
                    <div class="summary">
                        <div class="summary-item">
                            <div class="summary-value">${lowStockItems.filter(i => i.quantity === 0).length}</div>
                            <div class="summary-label">Critical Items</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">${lowStockItems.filter(i => i.quantity > 0 && i.quantity <= (i.minStock * 0.5)).length}</div>
                            <div class="summary-label">High Priority</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">${lowStockItems.filter(i => i.quantity > (i.minStock * 0.5) && i.quantity <= i.minStock).length}</div>
                            <div class="summary-label">Medium Priority</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">‚Çπ${lowStockItems.reduce((sum, i) => sum + (Math.max(0, i.minStock - i.quantity) * i.price), 0).toLocaleString('en-IN')}</div>
                            <div class="summary-label">Reorder Value</div>
                        </div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Item Name</th>
                                <th>Category</th>
                                <th>Current Stock</th>
                                <th>Min Required</th>
                                <th>Shortage</th>
                                <th>Unit Price</th>
                                <th>Reorder Cost</th>
                                <th>Priority</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${lowStockItems.map(item => {
                                const shortage = Math.max(0, item.minStock - item.quantity);
                                const urgencyLevel = item.quantity === 0 ? 'critical' : item.quantity <= (item.minStock * 0.5) ? 'high' : 'medium';
                                const urgencyLabels = { critical: 'üö® Critical', high: '‚ö†Ô∏è High', medium: '‚ö° Medium' };
                                
                                return `
                                    <tr class="${urgencyLevel}">
                                        <td>${item.name}</td>
                                        <td>${item.category}</td>
                                        <td>${item.quantity}</td>
                                        <td>${item.minStock}</td>
                                        <td>${shortage}</td>
                                        <td>‚Çπ${item.price.toFixed(2)}</td>
                                        <td>‚Çπ${(shortage * item.price).toFixed(2)}</td>
                                        <td>${urgencyLabels[urgencyLevel]}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                    
                    <div class="footer">
                        <p><strong>Stock Management Pro</strong> - Low Stock Alert System</p>
                        <p>This report requires immediate attention. Please restock critical items ASAP.</p>
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            
            setTimeout(() => {
                printWindow.print();
                showNotification('Low Stock ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡•á ‡§≤‡§ø‡§è ‡§§‡•à‡§Ø‡§æ‡§∞', 'success');
            }, 500);
        }

        // Quick add stock function with enhanced modal
        function quickAddStock(itemId, itemName) {
            const item = items.find(i => i.id === itemId);
            if (!item) {
                showNotification('‡§Ü‡§á‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ', 'error');
                return;
            }
            
            showAddStockModal(item);
        }

        // Show Add Stock Modal
        function showAddStockModal(item) {
            const modal = document.getElementById('add-stock-modal');
            if (!modal) {
                createAddStockModal();
                return showAddStockModal(item);
            }
            
            const shortage = Math.max(0, item.minStock - item.quantity);
            const suggestedQty = shortage > 0 ? shortage + Math.ceil(item.minStock * 0.2) : Math.ceil(item.minStock * 0.5);
            
            // Populate modal with item data
            document.getElementById('add-stock-item-name').textContent = item.name;
            document.getElementById('add-stock-category').textContent = item.category;
            document.getElementById('add-stock-current').textContent = item.quantity;
            document.getElementById('add-stock-min').textContent = item.minStock;
            document.getElementById('add-stock-shortage').textContent = shortage;
            document.getElementById('add-stock-price').textContent = `‚Çπ${item.price.toFixed(2)}`;
            
            // Set suggested quantity
            document.getElementById('add-stock-quantity').value = suggestedQty;
            document.getElementById('add-stock-notes').value = '';
            
            // Update calculations
            updateAddStockCalculations(item);
            
            // Store item reference
            window.currentAddStockItem = item;
            
            // Show modal with animation
            modal.classList.remove('hidden');
            const modalContent = document.getElementById('add-stock-modal-content');
            
            setTimeout(() => {
                modalContent.style.transform = 'scale(1)';
                modalContent.style.opacity = '1';
            }, 10);
            
            // Focus on quantity input
            setTimeout(() => {
                document.getElementById('add-stock-quantity').focus();
                document.getElementById('add-stock-quantity').select();
            }, 100);
        }

        // Create Add Stock Modal
        function createAddStockModal() {
            const modalHTML = `
                <!-- Add Stock Modal -->
                <div id="add-stock-modal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden flex items-center justify-center backdrop-blur-sm">
                    <div id="add-stock-modal-content" class="bg-white rounded-2xl shadow-2xl w-full max-w-lg mx-4 transform transition-all duration-300 scale-95 opacity-0">
                        <!-- Header -->
                        <div class="bg-gradient-to-r from-green-500 to-emerald-600 rounded-t-2xl p-6 text-white">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="bg-white bg-opacity-20 p-3 rounded-full">
                                        <span class="text-2xl">üì¶</span>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold">Add Stock</h3>
                                        <p class="text-green-100 text-sm">Increase inventory quantity</p>
                                    </div>
                                </div>
                                <button onclick="hideAddStockModal()" class="text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition-all">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Content -->
                        <div class="p-6">
                            <!-- Item Info Card -->
                            <div class="bg-gradient-to-r from-gray-50 to-slate-50 rounded-xl p-4 mb-6 border border-gray-200">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <div class="flex items-center gap-2 mb-3">
                                            <span class="text-lg">üìã</span>
                                            <h4 class="font-semibold text-gray-800">Item Details</h4>
                                        </div>
                                        <div class="space-y-2 text-sm">
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Name:</span>
                                                <span class="font-medium" id="add-stock-item-name">-</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Category:</span>
                                                <span class="font-medium" id="add-stock-category">-</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Unit Price:</span>
                                                <span class="font-medium text-green-600" id="add-stock-price">-</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex items-center gap-2 mb-3">
                                            <span class="text-lg">üìä</span>
                                            <h4 class="font-semibold text-gray-800">Stock Status</h4>
                                        </div>
                                        <div class="space-y-2 text-sm">
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Current:</span>
                                                <span class="font-bold text-blue-600" id="add-stock-current">-</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Min Required:</span>
                                                <span class="font-medium" id="add-stock-min">-</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Shortage:</span>
                                                <span class="font-bold text-red-600" id="add-stock-shortage">-</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Add Stock Form -->
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        <span class="flex items-center gap-2">
                                            <span>üìà</span>
                                            Quantity to Add *
                                        </span>
                                    </label>
                                    <input type="number" id="add-stock-quantity" min="1" placeholder="Enter quantity..." 
                                           class="w-full border-2 border-gray-300 rounded-xl px-4 py-3 text-lg font-semibold focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all"
                                           oninput="updateAddStockCalculations(window.currentAddStockItem)" onkeypress="handleAddStockEnter(event)">
                                    <div class="flex gap-2 mt-2">
                                        <button onclick="setQuickQuantity(10)" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1 rounded-lg text-sm transition-all">+10</button>
                                        <button onclick="setQuickQuantity(25)" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1 rounded-lg text-sm transition-all">+25</button>
                                        <button onclick="setQuickQuantity(50)" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1 rounded-lg text-sm transition-all">+50</button>
                                        <button onclick="setQuickQuantity(100)" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1 rounded-lg text-sm transition-all">+100</button>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        <span class="flex items-center gap-2">
                                            <span>üìù</span>
                                            Notes (Optional)
                                        </span>
                                    </label>
                                    <input type="text" id="add-stock-notes" placeholder="Reason for stock addition..." 
                                           class="w-full border-2 border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all">
                                </div>
                                
                                <!-- Calculations -->
                                <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4 border-2 border-green-200">
                                    <h4 class="font-semibold text-green-800 mb-3 flex items-center gap-2">
                                        <span>üßÆ</span>
                                        Calculations
                                    </h4>
                                    <div class="grid grid-cols-2 gap-4 text-sm">
                                        <div class="space-y-2">
                                            <div class="flex justify-between">
                                                <span class="text-green-700">New Stock Level:</span>
                                                <span class="font-bold text-green-800" id="add-stock-new-level">-</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-green-700">Investment:</span>
                                                <span class="font-bold text-green-800" id="add-stock-investment">‚Çπ0</span>
                                            </div>
                                        </div>
                                        <div class="space-y-2">
                                            <div class="flex justify-between">
                                                <span class="text-green-700">Status After:</span>
                                                <span class="font-bold" id="add-stock-status">-</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-green-700">Days Supply:</span>
                                                <span class="font-bold text-green-800" id="add-stock-days">-</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Footer -->
                        <div class="bg-gray-50 rounded-b-2xl px-6 py-4">
                            <div class="flex gap-3 justify-end">
                                <button onclick="hideAddStockModal()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-3 px-6 rounded-xl transition-all transform hover:scale-105">
                                    <span class="mr-2">‚ùå</span>
                                    Cancel
                                </button>
                                <button onclick="confirmAddStock()" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-3 px-8 rounded-xl transition-all transform hover:scale-105 shadow-lg">
                                    <span class="mr-2">‚úÖ</span>
                                    Add Stock
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        // Update Add Stock Calculations
        function updateAddStockCalculations(item) {
            if (!item) return;
            
            const quantity = parseInt(document.getElementById('add-stock-quantity').value) || 0;
            const newLevel = item.quantity + quantity;
            const investment = quantity * item.price;
            
            document.getElementById('add-stock-new-level').textContent = newLevel;
            document.getElementById('add-stock-investment').textContent = `‚Çπ${investment.toLocaleString('en-IN')}`;
            
            // Status after addition
            const statusEl = document.getElementById('add-stock-status');
            if (newLevel > item.minStock * 2) {
                statusEl.textContent = 'Excellent';
                statusEl.className = 'font-bold text-green-600';
            } else if (newLevel > item.minStock) {
                statusEl.textContent = 'Good';
                statusEl.className = 'font-bold text-blue-600';
            } else {
                statusEl.textContent = 'Still Low';
                statusEl.className = 'font-bold text-orange-600';
            }
            
            // Estimated days supply (assuming average consumption)
            const avgConsumption = 2; // Placeholder - could be calculated from transaction history
            const daysSupply = Math.floor(newLevel / avgConsumption);
            document.getElementById('add-stock-days').textContent = daysSupply > 0 ? `~${daysSupply} days` : 'N/A';
        }

        // Set Quick Quantity
        function setQuickQuantity(qty) {
            const currentQty = parseInt(document.getElementById('add-stock-quantity').value) || 0;
            document.getElementById('add-stock-quantity').value = currentQty + qty;
            updateAddStockCalculations(window.currentAddStockItem);
        }

        // Handle Enter Key in Add Stock
        function handleAddStockEnter(event) {
            if (event.key === 'Enter') {
                confirmAddStock();
            }
        }

        // Hide Add Stock Modal
        function hideAddStockModal() {
            const modal = document.getElementById('add-stock-modal');
            const modalContent = document.getElementById('add-stock-modal-content');
            
            modalContent.style.transform = 'scale(0.95)';
            modalContent.style.opacity = '0';
            
            setTimeout(() => {
                modal.classList.add('hidden');
                window.currentAddStockItem = null;
            }, 300);
        }

        // Confirm Add Stock
        function confirmAddStock() {
            const item = window.currentAddStockItem;
            if (!item) return;
            
            const quantity = parseInt(document.getElementById('add-stock-quantity').value);
            const notes = document.getElementById('add-stock-notes').value.trim();
            
            if (!quantity || quantity <= 0) {
                showNotification('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§π‡•Ä ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ ‡§≠‡§∞‡•á‡§Ç', 'error');
                return;
            }
            
            // Update item quantity
            item.quantity += quantity;
            
            // Record transaction
            const transaction = {
                id: Date.now(),
                itemId: item.id,
                itemName: item.name,
                type: 'in',
                quantity: quantity,
                notes: notes || 'Stock Addition',
                date: new Date().toISOString()
            };
            
            transactions.push(transaction);
            localStorage.setItem('stockItems', JSON.stringify(items));
            localStorage.setItem('stockTransactions', JSON.stringify(transactions));
            
            hideAddStockModal();
            showNotification(`${item.name} ‡§Æ‡•á‡§Ç ${quantity} ‡§∏‡•ç‡§ü‡•â‡§ï ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ`, 'success');
            init();
        }

        // View item history
        function viewItemHistory(itemId) {
            const item = items.find(i => i.id === itemId);
            if (!item) {
                showNotification('‡§Ü‡§á‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ', 'error');
                return;
            }
            
            // Set ledger filter to this item and switch to ledger view
            document.getElementById('ledger-filter-input').value = item.name;
            document.getElementById('ledger-filter').value = item.id;
            
            // Clear date filters to show all history
            document.getElementById('ledger-from-date').value = '';
            document.getElementById('ledger-to-date').value = '';
            
            // Scroll to ledger section
            document.querySelector('#ledger .bg-white.rounded-xl.shadow-lg').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
            
            // Update ledger display
            renderLedger();
            
            showNotification(`${item.name} ‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§¶‡§ø‡§ñ‡§æ‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à`, 'info');
        }

        // Export low stock report
        function exportLowStockReport() {
            const lowStockItems = items.filter(item => item.quantity <= item.minStock);
            
            if (lowStockItems.length === 0) {
                showNotification('‡§ï‡•ã‡§à Low Stock ‡§Ü‡§á‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ', 'info');
                return;
            }
            
            const reportData = lowStockItems.map(item => ({
                'Item Name': item.name,
                'Category': item.category,
                'Current Stock': item.quantity,
                'Min Stock Required': item.minStock,
                'Shortage': Math.max(0, item.minStock - item.quantity),
                'Unit Price': item.price.toFixed(2),
                'Reorder Value': (Math.max(0, item.minStock - item.quantity) * item.price).toFixed(2),
                'Status': item.quantity === 0 ? 'Out of Stock' : item.quantity <= (item.minStock * 0.5) ? 'Critical Low' : 'Low Stock'
            }));
            
            const csv = convertToCSV(reportData);
            downloadCSV(csv, `low_stock_report_${new Date().toISOString().split('T')[0]}.csv`);
            showNotification('Low Stock ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡•Ä ‡§ó‡§à', 'success');
        }

        // Render ledger with enhanced filtering
        function renderLedger() {
            const tbody = document.getElementById('ledger-table');
            const summaryContainer = document.getElementById('ledger-summary');
            const itemFilter = document.getElementById('ledger-filter').value;
            const fromDate = document.getElementById('ledger-from-date').value;
            const toDate = document.getElementById('ledger-to-date').value;
            
            let filteredTransactions = transactions;
            
            // Apply item filter
            if (itemFilter) {
                filteredTransactions = filteredTransactions.filter(t => t.itemId == itemFilter);
            }
            
            // Apply date filters
            if (fromDate) {
                const fromDateTime = new Date(fromDate).getTime();
                filteredTransactions = filteredTransactions.filter(t => new Date(t.date).getTime() >= fromDateTime);
            }
            
            if (toDate) {
                const toDateTime = new Date(toDate + 'T23:59:59').getTime();
                filteredTransactions = filteredTransactions.filter(t => new Date(t.date).getTime() <= toDateTime);
            }

            // Sort by date (oldest first for proper balance calculation)
            filteredTransactions.sort((a, b) => new Date(a.date) - new Date(b.date));

            if (filteredTransactions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-500">‡§ï‡•ã‡§à ‡§≤‡•á‡§ú‡§∞ ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä</td></tr>';
                summaryContainer.innerHTML = '';
                return;
            }

            // Calculate summary statistics
            let totalIn = 0, totalOut = 0, totalTransactions = 0;
            const itemBalances = {};
            const uniqueItems = new Set();
            const itemDetails = {};
            
            // Calculate running balance for each item and summary stats
            const ledgerRows = filteredTransactions.map(t => {
                if (!itemBalances[t.itemId]) {
                    itemBalances[t.itemId] = 0;
                }
                
                const inQty = t.type === 'in' ? t.quantity : 0;
                const outQty = t.type === 'out' ? t.quantity : 0;
                itemBalances[t.itemId] += inQty - outQty;
                
                totalIn += inQty;
                totalOut += outQty;
                totalTransactions++;
                uniqueItems.add(t.itemName);
                
                // Store item details for balance summary
                if (!itemDetails[t.itemId]) {
                    const item = items.find(i => i.id == t.itemId);
                    itemDetails[t.itemId] = {
                        name: t.itemName,
                        category: item ? item.category : 'Unknown',
                        currentStock: item ? item.quantity : 0,
                        minStock: item ? item.minStock : 0,
                        price: item ? item.price : 0
                    };
                }
                
                return {
                    date: new Date(t.date).toLocaleDateString('en-IN'),
                    itemName: t.itemName,
                    notes: t.notes || (t.type === 'in' ? 'Stock In' : 'Stock Out'),
                    inQty,
                    outQty,
                    balance: itemBalances[t.itemId],
                    transaction: t
                };
            });

            // Render summary cards
            summaryContainer.innerHTML = `
                <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4 border-l-4 border-green-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-600 text-sm font-medium">üìà Total Stock In</p>
                            <p class="text-2xl font-bold text-green-700">${totalIn}</p>
                        </div>
                        <div class="bg-green-100 p-3 rounded-full">
                            <span class="text-2xl">‚¨ÜÔ∏è</span>
                        </div>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-red-50 to-rose-50 rounded-xl p-4 border-l-4 border-red-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-600 text-sm font-medium">üìâ Total Stock Out</p>
                            <p class="text-2xl font-bold text-red-700">${totalOut}</p>
                        </div>
                        <div class="bg-red-100 p-3 rounded-full">
                            <span class="text-2xl">‚¨áÔ∏è</span>
                        </div>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border-l-4 border-blue-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-600 text-sm font-medium">üìä Total Transactions</p>
                            <p class="text-2xl font-bold text-blue-700">${totalTransactions}</p>
                            <p class="text-xs text-blue-500 mt-1">${uniqueItems.size} unique items</p>
                        </div>
                        <div class="bg-blue-100 p-3 rounded-full">
                            <span class="text-2xl">üíº</span>
                        </div>
                    </div>
                </div>
            `;

            // Render table rows (reverse for latest first display)
            tbody.innerHTML = ledgerRows.reverse().map(row => `
                <tr class="border-b border-gray-100 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 transition-all">
                    <td class="py-3 px-4 font-medium">${row.date}</td>
                    <td class="py-3 px-4">
                        <div class="flex items-center gap-2">
                            <span class="bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xs">üì¶</span>
                            <span class="font-medium">${row.itemName}</span>
                        </div>
                    </td>
                    <td class="py-3 px-4">
                        <span class="bg-gray-50 text-gray-700 px-2 py-1 rounded-lg text-sm">${row.notes}</span>
                    </td>
                    <td class="py-3 px-4 text-green-600 font-semibold">${row.inQty || '-'}</td>
                    <td class="py-3 px-4 text-red-600 font-semibold">${row.outQty || '-'}</td>
                    <td class="py-3 px-4 font-bold text-lg ${row.balance > 0 ? 'text-green-700' : row.balance < 0 ? 'text-red-700' : 'text-gray-700'}">${row.balance}</td>
                </tr>
            `).join('');
        }





        // Clear ledger filters
        function clearLedgerFilters() {
            document.getElementById('ledger-filter-input').value = '';
            document.getElementById('ledger-filter').value = '';
            document.getElementById('ledger-from-date').value = '';
            document.getElementById('ledger-to-date').value = '';
            renderLedger();
            showNotification('‡§´‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§∏‡§æ‡§´ ‡§ï‡§ø‡§è ‡§ó‡§è', 'info');
        }

        // Print ledger functionality
        function printLedger() {
            const itemFilter = document.getElementById('ledger-filter').value;
            const fromDate = document.getElementById('ledger-from-date').value;
            const toDate = document.getElementById('ledger-to-date').value;
            
            let filteredTransactions = transactions;
            
            // Apply same filters as display
            if (itemFilter) {
                filteredTransactions = filteredTransactions.filter(t => t.itemId == itemFilter);
            }
            
            if (fromDate) {
                const fromDateTime = new Date(fromDate).getTime();
                filteredTransactions = filteredTransactions.filter(t => new Date(t.date).getTime() >= fromDateTime);
            }
            
            if (toDate) {
                const toDateTime = new Date(toDate + 'T23:59:59').getTime();
                filteredTransactions = filteredTransactions.filter(t => new Date(t.date).getTime() <= toDateTime);
            }

            if (filteredTransactions.length === 0) {
                showNotification('‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ã‡§à ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ', 'error');
                return;
            }

            // Sort by date for proper balance calculation
            filteredTransactions.sort((a, b) => new Date(a.date) - new Date(b.date));

            // Calculate summary and prepare data
            let totalIn = 0, totalOut = 0;
            const itemBalances = {};
            const printData = [];
            
            filteredTransactions.forEach(t => {
                if (!itemBalances[t.itemId]) {
                    itemBalances[t.itemId] = 0;
                }
                
                const inQty = t.type === 'in' ? t.quantity : 0;
                const outQty = t.type === 'out' ? t.quantity : 0;
                itemBalances[t.itemId] += inQty - outQty;
                
                totalIn += inQty;
                totalOut += outQty;
                
                printData.push({
                    date: new Date(t.date).toLocaleDateString('en-IN'),
                    itemName: t.itemName,
                    notes: t.notes || (t.type === 'in' ? 'Stock In' : 'Stock Out'),
                    inQty: inQty || '-',
                    outQty: outQty || '-',
                    balance: itemBalances[t.itemId]
                });
            });

            // Create print window
            const printWindow = window.open('', '_blank');
            const selectedItem = itemFilter ? items.find(i => i.id == itemFilter)?.name : 'All Items';
            const dateRange = fromDate && toDate ? `${fromDate} to ${toDate}` : fromDate ? `From ${fromDate}` : toDate ? `Till ${toDate}` : 'All Dates';
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Stock Ledger Report</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 20px; 
                            color: #333;
                        }
                        .header { 
                            text-align: center; 
                            margin-bottom: 30px; 
                            border-bottom: 3px solid #3B82F6;
                            padding-bottom: 20px;
                        }
                        .company-name { 
                            font-size: 28px; 
                            font-weight: bold; 
                            color: #1E40AF;
                            margin-bottom: 5px;
                        }
                        .report-title { 
                            font-size: 20px; 
                            color: #374151;
                            margin-bottom: 10px;
                        }
                        .filters { 
                            background: #F3F4F6; 
                            padding: 15px; 
                            border-radius: 8px; 
                            margin-bottom: 20px;
                        }
                        .filter-row { 
                            display: flex; 
                            justify-content: space-between; 
                            margin-bottom: 5px;
                        }
                        .summary { 
                            display: flex; 
                            justify-content: space-around; 
                            margin-bottom: 20px; 
                            background: #F9FAFB;
                            padding: 15px;
                            border-radius: 8px;
                        }
                        .summary-item { 
                            text-align: center; 
                            padding: 10px;
                        }
                        .summary-value { 
                            font-size: 24px; 
                            font-weight: bold; 
                            color: #1F2937;
                        }
                        .summary-label { 
                            font-size: 12px; 
                            color: #6B7280; 
                            margin-top: 5px;
                        }
                        table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin-top: 20px;
                            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
                        }
                        th { 
                            background: #3B82F6; 
                            color: white; 
                            padding: 12px 8px; 
                            text-align: left; 
                            font-weight: bold;
                        }
                        td { 
                            padding: 10px 8px; 
                            border-bottom: 1px solid #E5E7EB;
                        }
                        tr:nth-child(even) { 
                            background: #F9FAFB;
                        }
                        tr:hover { 
                            background: #EBF4FF;
                        }
                        .text-green { color: #059669; font-weight: bold; }
                        .text-red { color: #DC2626; font-weight: bold; }
                        .text-blue { color: #2563EB; font-weight: bold; }
                        .footer { 
                            margin-top: 30px; 
                            text-align: center; 
                            font-size: 12px; 
                            color: #6B7280;
                            border-top: 1px solid #E5E7EB;
                            padding-top: 15px;
                        }
                        @media print {
                            body { margin: 0; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="company-name">üì¶ Stock Management Pro</div>
                        <div class="report-title">Stock Ledger Report</div>
                        <div style="font-size: 14px; color: #6B7280;">Generated on ${new Date().toLocaleString('en-IN')}</div>
                    </div>
                    
                    <div class="filters">
                        <div class="filter-row">
                            <strong>Item:</strong> <span>${selectedItem}</span>
                        </div>
                        <div class="filter-row">
                            <strong>Date Range:</strong> <span>${dateRange}</span>
                        </div>
                        <div class="filter-row">
                            <strong>Total Records:</strong> <span>${printData.length}</span>
                        </div>
                    </div>
                    
                    <div class="summary">
                        <div class="summary-item">
                            <div class="summary-value text-green">${totalIn}</div>
                            <div class="summary-label">Total Stock In</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value text-red">${totalOut}</div>
                            <div class="summary-label">Total Stock Out</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value text-blue">${totalIn - totalOut}</div>
                            <div class="summary-label">Net Movement</div>
                        </div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Item Name</th>
                                <th>Transaction</th>
                                <th>Stock In</th>
                                <th>Stock Out</th>
                                <th>Balance</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${printData.map(row => `
                                <tr>
                                    <td>${row.date}</td>
                                    <td>${row.itemName}</td>
                                    <td>${row.notes}</td>
                                    <td class="text-green">${row.inQty}</td>
                                    <td class="text-red">${row.outQty}</td>
                                    <td class="text-blue">${row.balance}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div class="footer">
                        <p><strong>Stock Management Pro</strong> - Advanced Inventory Management System</p>
                        <p>This is a computer generated report. No signature required.</p>
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            
            // Wait for content to load then print
            setTimeout(() => {
                printWindow.print();
                showNotification('‡§≤‡•á‡§ú‡§∞ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡•á ‡§≤‡§ø‡§è ‡§§‡•à‡§Ø‡§æ‡§∞', 'success');
            }, 500);
        }

        // Update transaction item select (now handled by dropdown)
        function updateTransactionItemSelect() {
            // This function is now handled by the searchable dropdown
            // No need to populate a select element
        }

        // Update ledger filter (now handled by searchable dropdown)
        function updateLedgerFilter() {
            // This function is now handled by the searchable dropdown
            // Initialize with "All Items" by default
            document.getElementById('ledger-filter-input').value = '';
            document.getElementById('ledger-filter').value = '';
        }

        // Filter ledger
        function filterLedger() {
            renderLedger();
        }







        // Enhanced initialization
        function init() {
            console.log('Initializing Stock Management System...');
            
            try {
                updateDashboard();
                renderItems();
                renderTransactions();
                renderLedger();
                renderLowStockTab();
                updateTransactionItemSelect();
                updateLedgerFilter();
                setupSearch();
                setupCategoryInput();
                setupItemInput();
                setupLedgerItemInput();
                
                // Update time every second
                setInterval(updateTime, 1000);
                updateTime();
                
                // Ensure dashboard is shown by default
                showTab('dashboard');
                
                console.log('‚úÖ System initialized successfully!');
            } catch (error) {
                console.error('‚ùå Error during initialization:', error);
                showNotification('‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à', 'error');
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, starting initialization...');
            init();
        });
        
        // Fallback initialization
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97115440535c597b',t:'MTc1NTUxOTI0Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
